<!-- style="height: 80vh; overflow: scroll;" -->

<!-- <p>{{ questionresponse.latest | json }}</p> -->

<ng-container *ngIf="false">
    <mat-card class="custom-shadow ">
        <div class="row">
            <div class="col-sm-12">
                <h4 class="text-center text-primary common-font-family" *ngIf="title">{{title}}</h4>
                <p class="desc" *ngIf="formDescription">{{formDescription}}</p>
                <div class="row mb-5" *ngIf="showFormChange">
                    <div class="col-sm-8 px-0">
                        <input type="text" autocomplete="name" name="name" class="form-control" [(ngModel)]="formId"
                            placeholder="Enter Form Id and then press Submit" [ngModelOptions]="{standalone: true}" />
                    </div>
                    <div class="col-sm-2"><button class="btn btn-sm btn-primary text-uppercase "
                            (click)="onChangeForm()">Submit</button></div>
                </div>

                <div class="row">
                    <div class="col-sm-6" [ngClass]="isOpenChevron ? 'col-sm-6' : 'col-sm-12'">
                        <i *ngIf="showPreviewAnswer" class="fa fa-chevron-circle-left chevron-right"
                            (click)="isOpenChevron = !isOpenChevron"></i>
                        <!-- <div class="col-sm-12 mb-5 card p-3">{{formtitle}}</div> -->



                        <div class=" mt-2 p-3">
                            <div class="row" style="align-items:end;">
                                <!-- As the references change ngFor will continuously regenerate the DOM
               However, the presence of trackBy provides ngFor some help.
               It modifies the behavior so that it compares new data to old based on
               the return value of the supplied trackBy method.
               This allows Angular to reduce the amount of DOM update needed -->
                                <!-- myfilter => myfilter is used to filter out visible question -->
                                <ng-container
                                    *ngFor="let question of questionData | myfilter; trackBy:identity; let questionIndex = index"
                                    [ngTemplateOutlet]="treeNode"
                                    [ngTemplateOutletContext]="{ question: question, questionIndex:questionIndex, value: [] }">
                                </ng-container>
                            </div>
                        </div>

                    </div>
                    <div class="col-sm-6 float-left" *ngIf="isOpenChevron">
                        <div class="col-sm-12 mb-3 card p-3 ">Preview Answers</div>
                        <div class="col-sm-12 font-weight-500">{{completedLenegth()}}</div>
                        <div class="col-sm-12 card mt-2 p-3"
                            *ngFor="let question of questionData; let answerIndex = index"
                            [ngClass]="{'d-none': !question.selectedValue || (question.selectedValue && question.selectedValue.length == 0)}">
                            <div class="row" *ngIf="question?.selectedValue?.length">
                                <div class="col-sm-12 mb-3 " style="font-size: 90%;">
                                    {{answerIndex+1}}. {{question.title}}
                                </div>
                                <div class="col-sm-12 font-weight-500" style="font-size: 90%;">
                                    <div
                                        *ngIf="question.answer_option && question.answer_option.length; else defaultAnswer">
                                        <div class="col-sm-12 text-justify">Answers</div>
                                        <ul>
                                            <li *ngFor="let answer of question.selectedValue">
                                                {{answer.label}} {{answer.textValue}}
                                            </li>
                                        </ul>
                                    </div>
                                    <ng-template #defaultAnswer>
                                        <div class="col-sm-12  font-weight-500 text-justify" style="font-size: 90%;">
                                            Answer:
                                            <span *ngIf="(question?.acceptableType == 'image/*') && (question?.value)">
                                                <img class="mx-1"
                                                    [src]="question?.imgUrl ? question?.imgUrl : question?.value"
                                                    height="60" width="60" style="object-fit:contain; display: block;">
                                            </span> {{question?.selectedValue[0]?.textValue ?
                                            question?.selectedValue[0]?.textValue : question?.selectedValue[0]?.value}}
                                        </div>
                                    </ng-template>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="d-flex justify-content-end" *ngIf="showSubmitButton">
            <button class="btn btn-sm btn-primary text-uppercase"
                [disabled]="isImageUploading || isFormSubmittedSuccessfully" (click)="beforeSubmitPrepareResponse()"
                *ngIf="!pdfbuttonhide">
                {{buttonText}}
                <!-- Save -->
            </button>
        </div>
    </mat-card>
    <div class="row container" *ngIf="disclaimerMessage">
        <span class="text-primary">{{disclaimerMessage}}</span>
    </div>

    <!-- { question: child, questionIndex:questionIndexes, value: [question.value[questionIndexes]]} -->

    <ng-template #treeNode let-question="question" let-questionIndex="questionIndex" let-value="value">
        <ng-container class="row" [ngSwitch]="question?.input_type">

            <!-- condition for different col-width "col-sm-6" for 25 when isOpenChevron is true ( open ) -->
            <!-- [ngClass]="{'col-sm-12': ( question.width == '100' || isOpenChevron ) && question.width != '25' , 'col-sm-6': (question.width == '50' && !isOpenChevron ) || ( question.width == '25' && isOpenChevron ) , 'col-sm-3': ( question.width == '25' && !isOpenChevron ) }" -->
            <!-- [ngClass]="{'col-sm-12': ( question.width == '100' || isOpenChevron ), 'col-sm-6': (question.width == '50' && !isOpenChevron ) || ( question.width == '25' && isOpenChevron ) , 'col-sm-3': ( question.width == '25' && !isOpenChevron ), 'custom-col-sm-2': ( question.width == '20' && !isOpenChevron ) }" -->
            <div class="common-font-family mb-3 col-12" *ngSwitchCase="QUESTION_TYPE.TEXT">
                <div class="d-flex justify-content-between">
                    <label for="{{question.order}}">{{question.title}}<span *ngIf="question?.required"
                            class="text-primary">*</span></label>
                    <!-- <div *ngIf="question?.showComment" class="mr-3">
                         <span class="commentSelector" *ngIf="!pdfbuttonhide">
                             <app-show-comments (lastComment)="lastComment($event)" [location]="question?.commentApi" [lineItemId]="question?.commentLineItemId" [comment]="comments"></app-show-comments>
                         </span>
                     </div> -->
                </div>
                <span class=""
                    [ngClass]="{'disable-question-field disable-question-field-opacity': ( question?.isQuestionDisabled ) }">
                    <input type="{{question?.passwordMode ? 'password' : 'text'}}" autocomplete="{{question.order}}"
                        name="{{question.order}}" appAlphabetOnly class="form-control " pattern="{{question?.pattern}}"
                        placeholder="{{question?.hint}}" minlength="{{question.min}}" appRestrictFirstCharAsSpace
                        [ngClass]="{'invalid-border': question.errorMessage}" maxlength="{{question.max}}"
                        id="{{(question?.forParentValue) ? question?.forParentValue : question.order}}"
                        [value]="question.modelValue ? question.modelValue : ''" (change)="onChange(question, $event)"
                        [ngModelOptions]="{standalone: true}" (focus)="onFocusEvent(question.order, question)"
                        [readonly]="question?.isQuestionDisabled"  [appNumberLength]="question.max"/>
                    <ng-container *ngIf="question?.isPassword">
                        <i *ngIf="!question?.passwordMode" [matTooltip]="'Hide'"
                            (click)="question.passwordMode = !question.passwordMode"
                            class="fa fa-eye passwordShowHide pointer-hand" aria-hidden="true"></i>
                        <i *ngIf="question?.passwordMode" [matTooltip]="'Show'"
                            (click)="question.passwordMode = !question.passwordMode"
                            class="fa fa-eye-slash passwordShowHide pointer-hand" aria-hidden="true"></i>
                    </ng-container>
                    <!-- <label class="" for="{{question.order}}">{{question.title}} <span *ngIf="question.required"
                 class="text-primary">*</span></label> -->
                    <mat-icon class="input-eye-icon" *ngIf="question?.information" [matTooltip]="question?.information">
                        info</mat-icon>
                </span>
                <div *ngIf="(question?.labelInstruction) && (!question.errorMessage)" class="label-instruction">
                    <em>* {{question?.labelInstruction}}</em>
                </div>
                <div class="col-sm-12  font-weight-500 text-primary error-msg" *ngIf="question.errorMessage">
                    {{question.information?question.information:question.errorMessage}}
                </div>
            </div>

            <!-- [ngClass]="{'col-sm-12': ( question.width == '100' || isOpenChevron ), 'col-sm-6': (question.width == '50' && !isOpenChevron ) || ( question.width == '25' && isOpenChevron ) , 'col-sm-3': ( question.width == '25' && !isOpenChevron ), 'custom-col-sm-2': ( question.width == '20' && !isOpenChevron ) }" -->
            <div class="common-font-family mb-3 col-sm-12" *ngSwitchCase="QUESTION_TYPE.ADDRESS">
                <!-- <input type="text" class="form-control" minlength="{{question.min}}" [ngClass]="{'invalid-border': question.errorMessage}" maxlength="{{question.max}}" id="{{question.order}}" [value]="question.modelValue ? question.modelValue : ''" (change)="onChange(question, $event)" [ngModelOptions]="{standalone: true}" /> -->
                <div class="d-flex justify-content-between">
                    <label for="{{question.order}}">{{question.title}}<span *ngIf="question.required"
                            class="text-primary">*</span></label>
                    <!-- <div *ngIf="question?.showComment" class="mr-3">
                         <span class="commentSelector" *ngIf="!pdfbuttonhide">
                             <app-show-comments (lastComment)="lastComment($event)" [location]="question?.commentApi"
                                 [lineItemId]="question?.commentLineItemId" [comment]="comments"></app-show-comments>
                         </span>
                     </div> -->
                </div>
                <span class="" [ngClass]="{'disable-question-field': ( question?.isQuestionDisabled ) }">
                    <textarea [appAlphabetOnly]="unBlockCharObject" autocomplete="{{question.order}}"
                        [wordLimit]="question" class="form-control " placeholder="{{question?.hint}}"
                        minlength="{{question.min}}" [ngClass]="{'invalid-border': question.errorMessage}"
                        maxlength="{{question.max}}" id="{{question.order}}" name="{{question.order}}"
                        [value]="question.modelValue ? question.modelValue : ''" (change)="onChange(question, $event)"
                        [ngModelOptions]="{standalone: true}" style="height: 80px"
                        (focus)="onFocusEvent(question.order, question)" appRestrictFirstCharAsSpace
                        [readonly]="question?.isQuestionDisabled">
             </textarea>
                    <mat-icon class="input-eye-icon" *ngIf="question?.information" [matTooltip]="question?.information">
                        info</mat-icon>
                </span>
                <div class="col-sm-12  font-weight-500 text-primary error-msg" *ngIf="question.errorMessage">
                    {{question.information?question.information:question.errorMessage}}
                </div>
            </div>

            <!-- [ngClass]="{'col-sm-12': ( question.width == '100' || isOpenChevron ), 'col-sm-6': (question.width == '50' && !isOpenChevron ) || ( question.width == '25' && isOpenChevron ) , 'col-sm-3': ( question.width == '25' && !isOpenChevron ), 'custom-col-sm-2': ( question.width == '20' && !isOpenChevron ) }" -->
            <div class="common-font-family mb-3 col-12" *ngSwitchCase="QUESTION_TYPE.NUMERIC">
                <div class="d-flex justify-content-between">
                    <label class="" for="{{question.order}}">{{question.title}} <span *ngIf="question.required"
                            class="text-primary">*</span></label>
                    <!-- <div *ngIf="question?.showComment" class="mr-3">
                         <span class="commentSelector" *ngIf="!pdfbuttonhide">
                             <app-show-comments (lastComment)="lastComment($event)" [location]="question?.commentApi"
                                 [lineItemId]="question?.commentLineItemId" [comment]="comments"></app-show-comments>
                         </span>
                     </div> -->
                </div>
                <span class="" [ngClass]="{'disable-question-field': ( question?.isQuestionDisabled ) }">
                    <input digitOnly [decimal]="question?.skipDigitOnlyValidation" type="number" class="form-control "
                        [appNumberLength]="question.max" placeholder="{{question.hint}}"
                        [ngClass]="{'invalid-border': question.errorMessage}" minlength="{{question.min}}"
                        maxlength="{{question.max}}" id="{{question.order}}"
                        [value]="question.modelValue ? question.modelValue : ''" (change)="onChange(question, $event)"
                        [ngModelOptions]="{standalone: true}" (focus)="onFocusEvent(question.order, question)"
                        [appRestrictFirstDigitAsZero]="isAppRestrictFirstDigitAsZero"
                        [readonly]="question?.isQuestionDisabled" title="" step="any" autocomplete="off"/> 
                    <mat-icon class="input-eye-icon" *ngIf="question?.information" [matTooltip]="question?.information">
                        info</mat-icon>
                </span>
                <div *ngIf="(question?.labelInstruction) && (!question.errorMessage)" class="label-instruction">
                    <em>* {{question?.labelInstruction}}</em>
                </div>
                <div class="col-sm-12  font-weight-500 text-primary error-msg" *ngIf="question.errorMessage">
                    {{question.information?question.information:question.errorMessage}}
                </div>
            </div>

            <!-- <div class="mb-3" [ngClass]="{'col-sm-12': ( question.width == '100' || isOpenChevron ), 'col-sm-6': (question.width == '50' && !isOpenChevron ) || ( question.width == '25' && isOpenChevron ) , 'col-sm-3': ( question.width == '25' && !isOpenChevron ), 'custom-col-sm-2': ( question.width == '20' && !isOpenChevron ) }"
                 *ngSwitchCase="QUESTION_TYPE.RADIO"> -->
            <div class="common-font-family mb-3 col-12" *ngSwitchCase="QUESTION_TYPE.RADIO">
                <div class="row">
                    <div class="col-6 mb-3  "
                        [ngClass]="{'invalid-border': question.errorMessage,'disable-question-field': question?.isQuestionDisabled }"
                        style="font-size: 90%;">
                        {{question.title}}
                        <span *ngIf="question.required" class="text-primary">*</span>
                        <mat-icon class="radio-info-icon" *ngIf="question?.information"
                            [matTooltip]="question?.information">info</mat-icon>
                    </div>
                    <div class="col-6 d-flex justify-content-between">
                        <mat-radio-group aria-label="Select an option"
                            [ngClass]="{'disable-question-field': ( question?.isQuestionDisabled ) }"
                            [disabled]="question?.isQuestionDisabled">
                            <mat-radio-button class="mr-2 " [disabled]="option?.disabled"
                                *ngFor="let option of question.answer_option;let i=index" [value]="option._id"
                                [checked]="option._id == question.modelValue"
                                (change)="onChange(question, $event, option)">
                                {{option?.name}}</mat-radio-button>
                        </mat-radio-group>
                        <!-- <div *ngIf="question?.showComment" class="mr-3">
                             <span class="commentSelector" *ngIf="!pdfbuttonhide">
                                 <app-show-comments (lastComment)="lastComment($event)" [location]="question?.commentApi" [lineItemId]="question?.commentLineItemId" [comment]="comments"></app-show-comments>
                             </span>
                         </div> -->
                    </div>
                    <div class="col-6  font-weight-500 text-primary error-msg" *ngIf="question.errorMessage">
                        {{question.information?question.information:question.errorMessage}}
                    </div>
                </div>
            </div>

            <!-- [ngClass]="{'col-sm-12': ( question.width == '100' || isOpenChevron ), 'col-sm-6': (question.width == '50' && !isOpenChevron ) || ( question.width == '25' && isOpenChevron ) , 'col-sm-3': ( question.width == '25' && !isOpenChevron ), 'custom-col-sm-2': ( question.width == '20' && !isOpenChevron ) }" -->
            <div class="common-font-family mb-3 col-sm-6" *ngSwitchCase="QUESTION_TYPE.FILE_UPLOAD">
                <div class="row">
                    <div class="col-sm-12 mb-2 d-flex justify-content-between" style="font-size: 90%; color: #6c757d;">
                        <div>
                            {{question.title}}
                            <span *ngIf="question.required" class="text-primary">*</span>
                            <mat-icon class="file-type-info" *ngIf="question?.information"
                                [matTooltip]="question?.information">info</mat-icon>
                        </div>
                        <!-- <div *ngIf="question?.showComment" class="mr-3">
                             <span class="commentSelector" *ngIf="!pdfbuttonhide">
                                 <app-show-comments (lastComment)="lastComment($event)" [location]="question?.commentApi" [lineItemId]="question?.commentLineItemId" [comment]="comments"></app-show-comments>
                             </span>
                         </div> -->
                    </div>
                    <div class="col-sm-2" *ngIf="question?.selectedValue?.length">
                        <span *ngFor="let file of question?.selectedValue" class="mt-2 float-right">
                            <ng-container *ngIf="file?.value">
                                <span class="file-icon position-relative pointer-hand {{ file?.value | fileIcon }}"
                                    matTooltip="Click to view the file" (click)="viewUploadedFile(question)"></span>
                                <span class="material-icons file-icon-cross pointer-hand"
                                    matTooltip="Remove the upload file"
                                    (click)="removeUploadedFile(question, question?.order)">cancel</span>
                            </ng-container>
                        </span>
                        <!-- <ng-container *ngIf="imagesExtension.includes(getFileExtensionFromURL(question?.modelValue));else noImage">
                             <span class="float-right" *ngFor="let file of question?.selectedValue">
                   <img class="mx-1" [src]="file?.value" height="60" width="60" style="object-fit:contain; display: block;">
                 </span>
                         </ng-container>
                         <ng-template #noImage>
                             <span *ngFor="let file of question?.selectedValue" class="mt-2 float-right">
                                 <a *ngIf="file?.value" [href]="file?.value" target="_blank">
                                     <span class="file-icon position-relative {{ file?.value | fileIcon }}"></span>
                                     <span class="material-icons file-icon-cross">cancel</span>
                                 </a>
                             </span>
                         </ng-template> -->
                    </div>
                    <!-- [ngClass]="{'col-sm-12': (!question?.value), 'col-sm-10': (question?.value) }" -->
                    <div class="d-flex align-items-center" [ngClass]="question?.value ? 'col-10' : 'col-12'">
                        <div class="custom-file" (click)="imageInputClickHandler($event, question)"
                            [ngClass]="{'disable-question-field': ( question?.isQuestionDisabled ) }">
                            <input type="file" id="{{question.order}}" class="form-control d-none"
                                [accept]="question?.acceptableType" (change)="docsInputChangeHandler($event, question)"
                                style="background-color: white !important; border-bottom: 0 !important">
                            <label class="custom-file-label pointer-hand" for="customFile"
                                [ngClass]="{'invalid-border': question.errorMessage}">
                                {{question.imgLabel ? question.imgLabel : question?.selectedValue?.length ?
                                question?.selectedValue[0]?.label : 'Choose file'}}</label>

                            <!-- <button mat-stroked-button type="button" class="mr-3 " (click)="imageInputClickHandler($event, question)">
                   <mat-icon>file_upload</mat-icon>
                   File Upload
                 </button> -->
                            <!-- <mat-chip class="mr-2 " *ngFor="let file of question.value">{{file.label}}</mat-chip> -->
                            <!-- <img *ngIf="question.descriptionImageUrl" src="{{question.descriptionImageUrl}}" alt="Image" height="42" width="42"> -->
                            <!-- <button mat-stroked-button type="button" class="ml-2" (click)="addRiskAndMitigation()">
                   Risk and Mitigation
                 </button> -->
                        </div>
                    </div>
                </div>
                <div class="col-sm-12  font-weight-500 text-primary error-msg" *ngIf="question.errorMessage">
                    {{question.hint?question.hint:question.errorMessage}}
                </div>
            </div>

            <!-- [ngClass]="{'col-sm-12': ( question.width == '100' || isOpenChevron ), 'col-sm-6': (question.width == '50' && !isOpenChevron ) || ( question.width == '25' && isOpenChevron ) , 'col-sm-3': ( question.width == '25' && !isOpenChevron ), 'invalid-border-class': ( question.errorMessage ), 'custom-col-sm-2': ( question.width == '20' && !isOpenChevron ) }" -->
            <div class="common-font-family customDropDown col-sm-6" *ngSwitchCase="QUESTION_TYPE.SINGLE_SELECT">
                <!-- <app-custom-dropdown [configuration]="question?.dropdownConfig" [datas]="question?.answer_option" (valueChanges)="onChange(question, {target: {value: $event.value}})"></app-custom-dropdown> -->
                <label for="{{question.order}}">{{question.title}}<span *ngIf="question.required"
                        class="text-primary">*</span></label>
                <mat-form-field class="w-100 d-block" [ngClass]="{'disable-question-field': ( question?.isQuestionDisabled ) }"
                    floatLabel="never">
                    <mat-label>{{question.hint}}
                    </mat-label>

                    <!-- [floatLabel]="isLoading ? 'never' : 'auto'" add this line mat-form-field -->
                    <!-- <mat-label *ngIf="!isLoading">{{question.title}}
             <span *ngIf="question.required" class="text-primary">*</span>
           </mat-label>

             <mat-label *ngIf="isLoading">
               <div class="select-placeholder-container">
                 <span>{{question.title}} Loading...</span>
                 <mat-spinner class="spinner" diameter="20"></mat-spinner>
               </div>
             </mat-label> -->
                    <!-- [disableOptionCentering]="true"    this is used to make options pannel position sticky  -->
                    <mat-select id="{{question.order}}" [(value)]="question.modelValue" [disableOptionCentering]="true"
                        panelClass="custom-mat-select-panel" (closed)="onSelectionClose(question?.order)"
                        [disabled]="question?.isQuestionDisabled"
                        (selectionChange)="getSelectionChange(question, $event)" [ngClass]="{'invalid-border': question.errorMessage}">
                        <div class="w-100 shadow-sm search-filter">
                            <!-- has-float-label - use this class in span tag and comment the label for floating label field -->
                            <span class="">
                                <input id="{{question.order+'_dropDownSearch'}}" type="text" class="form-control"
                                    placeholder="Search {{question.title}}" appRestrictFirstCharAsSpace appAlphabetOnly
                                    [(ngModel)]="searchedText"
                                    (ngModelChange)="getFilterAnswerOption($event, question);"
                                    (keydown)="$event.stopPropagation()">
                                <!-- <label for="{{question.order+'_dropDownSearch'}}">Search {{question.title}}</label> -->
                            </span>
                        </div>
                        <div class="single-select custom-y-scroll">
                            <mat-option *ngIf="question?.answer_option?.length == 0" disabled>No options available
                            </mat-option>
                            <mat-option *ngFor="let opt of question?.answer_option; trackBy:optionIdentity;"
                                [value]="opt?._id" [disabled]="opt?.disabled" class="mb-2"
                                [matTooltip]="opt.category ? opt.category : opt.name"
                                (click)="opt?.disabled ? '' : onChange(question, {target: {value: opt._id, isSelected: true}})">
                                <!-- {{opt.category ? opt.category : opt.name}} -->
                                <div class="d-flex flex-column mt-2" style="line-height: 1.2em;">
                                    <span>{{ opt.category ? opt.category : opt.name }}</span>
                                    <span *ngIf="opt && opt.info" matTooltip="{{opt?.info}}"
                                        class="option-info mt-1 text-truncate">{{opt?.info}}</span>
                                </div>
                            </mat-option>
                        </div>
                    </mat-select>
                    <mat-icon class="input-eye-icon" *ngIf="question?.information" [matTooltip]="question?.information"
                        style="font-size: 16px; right: 15px;">info</mat-icon>
                </mat-form-field>
                <!-- <span class="has-float-label" [ngClass]="{'disable-question-field': ( question?.isQuestionDisabled ) }">
             <select id="{{question.order}}" placeholder="{{question.title}}" (change)="onChange(question, $event)"
               name="{{question.modelValue}}" class="form-control  font-weight-500"
               [(ngModel)]="question.modelValue" [ngClass]="{'invalid-border': question.errorMessage}">
               <option class="" value="" disabled>Select Option
               </option>

               <option class="" [value]="opt._id" *ngFor="let opt of question.answer_option; trackBy:optionIndentity; let i=index"
                 [hidden]="opt?.disabled">{{opt.category ? opt.category : opt.name}}
               </option>
             </select>
             <label class="" for="{{question.order}}">{{question.title}} <span *ngIf="question.required"
                 class="text-primary">*</span></label>
                 <mat-icon class="input-eye-icon" *ngIf="question?.hint" [matTooltip]="question?.hint">info</mat-icon>
           </span> -->
                <div class="col-sm-12  font-weight-500 text-primary error-msg" *ngIf="question.errorMessage"
                    style="">
                    {{question.hint?question.hint:question.errorMessage}}
                </div>
            </div>

            <!-- Treating checkbox as multi select -->
            <!-- [ngClass]="{'col-sm-12': ( question.width == '100' || isOpenChevron ), 'col-sm-6': (question.width == '50' && !isOpenChevron ) || ( question.width == '25' && isOpenChevron ) , 'col-sm-3': ( question.width == '25' && !isOpenChevron ), 'invalid-border-class': ( question.errorMessage ), 'custom-col-sm-2': ( question.width == '20' && !isOpenChevron ) }" -->
            <div class="common-font-family customDropDown col-sm-6" *ngSwitchCase="QUESTION_TYPE.MULTI_SELECT">
                <label for="{{question.order}}">{{question.title}}<span *ngIf="question.required"
                        class="text-primary">*</span></label>
                <!-- <div class="col-sm-12 mb-3 " id="{{question.order}}" [ngClass]="{'invalid-border': question.errorMessage}">{{question.title}} <span *ngIf="question.required" class="text-primary">*</span></div>
         <div class="col-sm-12" *ngFor="let option of question.answer_option;let i=index">
           <mat-checkbox class="m-3  font-weight-500" (change)="onChange(question, $event, option)" [checked]="option.checked">{{option.name}}</mat-checkbox>
         </div> -->

                <!-- <ng-multiselect-dropdown [settings]="question.settings" [data]="question.answer_option" [(ngModel)]="question.selectedValue"
             (onSelect)="onItemSelect(question, $event)" (onDeSelect)="onItemDeSelect(question, $event)">
           </ng-multiselect-dropdown> -->
                <!-- (onDeSelectAll)="onUnSelectAll()" -->
                <!-- (onSelectAll)="onSelectAll($event)" -->
                <!-- (onDropDownClose)="onDropDownClose(question)" -->
                <!-- (mouseleave)="collapseMultiSelectDropdown(question?.order)" -->
                <!-- <div class="multiselect" (mouseleave)="collapseMultiSelectDropdown(question?.order)"
           [ngClass]="{'disable-question-field': ( question?.isQuestionDisabled ) }">
             <div class="selectBox" (click)="showCheckboxes(question?.order)">
               <span class="has-float-label">
                 <select class="form-control  font-weight-500" id="{{question.order}}"
                   placeholder="{{question.title}}" [ngClass]="{'invalid-border': question.errorMessage}"
                   [ngStyle]="{'color':question?.selectedValue?.length == 0 ? '#999999' : '#000000' }" style="font-size: 13px;">
                   <option *ngIf="question?.selectedValue?.length == 0; else showSelectedOption">Select {{question?.title}}
                   </option>
                   <ng-template #showSelectedOption>
                     <option>{{question?.selectedOptions}}</option>
                   </ng-template>
                 </select>
                 <label class="" for="{{question.order}}">{{question?.title}} <span *ngIf="question.required"
                     class="text-primary">*</span></label>

               </span>
               <div class="overSelect"></div>
             <mat-icon class="input-eye-icon" *ngIf="question?.hint" [matTooltip]="question?.hint">info</mat-icon>
             </div>
             <div class="checkboxes shadow custom-y-scroll" [id]="'checkboxes'+question.order">
               <ng-container *ngIf="question['checkboxes'+question.order]">
                 <div class="" style="padding: 10px;">
                   <span class="has-float-label">
                     <input type="text" class="font-weight-500 form-control" placeholder="Search..." appRestrictFirstCharAsSpace
                     [(ngModel)]="searchedText" (ngModelChange)="getFilterAnswerOption($event, question);" >
                     <label for="name">Search...</label>
                   </span>
                 </div>
                 <ng-container *ngFor="let option of question?.answer_option; let i=index"><br>
                   <mat-checkbox class="m-3  font-weight-500 font-13" id="{{option?._id}}"
                     (change)="onChange(question, $event, option)" [checked]="option?.checked">
                     {{option?.name}}
                   </mat-checkbox>
                 </ng-container>
               </ng-container>
             </div>
           </div> -->

                <mat-form-field class="w-100" [ngClass]="{'disable-question-field': ( question?.isQuestionDisabled ) }"
                    floatLabel="never">
                    <mat-label>{{question.hint}}
                    </mat-label>
                    <mat-select id="{{question.order}}" panelClass="custom-mat-select-panel" multiple
                        [(ngModel)]="question.value" [disableOptionCentering]="true"
                        (closed)="onSelectionClose(question?.order)" [disabled]="question?.isQuestionDisabled" >
                        <div class="w-100 shadow-sm search-filter">
                            <!-- has-float-label - use this class in span tag and comment the label for floating label field -->
                            <span class="">
                                <input id="{{question.order+'_dropDownSearch'}}" type="text" class="form-control"
                                    placeholder="Search {{question.title}}" appRestrictFirstCharAsSpace appAlphabetOnly
                                    [(ngModel)]="searchedText"
                                    (ngModelChange)="getFilterAnswerOption($event, question);"
                                    (keydown)="$event.stopPropagation()">
                                <!-- <label for="{{question.order+'_dropDownSearch'}}">Search {{question.title}}</label> -->
                            </span>
                        </div>
                        <div class="single-select custom-y-scroll">
                            <mat-option *ngIf="question?.answer_option?.length == 0" disabled>No options available
                            </mat-option>
                            <mat-option *ngFor="let option of question?.answer_option; let i=index" [value]="option._id"
                                [disabled]="option?.disabled" [matTooltip]="option?.name" class="mb-2"
                                (click)="option?.disabled ? '' : onChange(question, {checked: !option.checked}, option)">
                                <!-- {{option?.name}} -->
                                <div class="d-flex flex-column mt-2" style="line-height: 1.2em;">
                                    <span>{{ option?.name }}</span>
                                    <span *ngIf="option && option.info" matTooltip="{{option?.info}}"
                                        class="option-info mt-1 text-truncate">{{option?.info}}</span>
                                </div>
                            </mat-option>
                        </div>
                    </mat-select>
                    <mat-icon class="input-eye-icon" *ngIf="question?.information" [matTooltip]="question?.information"
                        style="font-size: 16px; right: 20px;">info</mat-icon>
                </mat-form-field>

                <div class="col-sm-12  font-weight-500 text-primary error-msg" *ngIf="question.errorMessage">
                    {{question.information?question.information:question.errorMessage}}
                </div>
            </div>

            <!-- [ngClass]="{'col-sm-12': ( question.width == '100' || isOpenChevron ), 'col-sm-6': (question.width == '50' && !isOpenChevron ) || ( question.width == '25' && isOpenChevron ) , 'col-sm-3': ( question.width == '25' && !isOpenChevron ), 'custom-col-sm-2': ( question.width == '20' && !isOpenChevron ) }" -->
            <div class="common-font-family mb-3 col-sm-6" *ngSwitchCase="QUESTION_TYPE.DATE">
                <!-- <div class="col-sm-12  font-weight-500" style="font-size: 80%; color: #6c757d;" >{{question.title}} <span *ngIf="question.required"
               class="text-primary">*</span></div> -->
                <!-- <mat-form-field class="col-sm-2" style="width: 18%">
           <input readonly matInput class="form-control  font-weight-500" placeholder="{{question.title}}" [(ngModel)]="question.modelValue" (change)="onChange(question, $event)" [ngModelOptions]="{standalone: true}"
                 [matDatepicker]="myDatepickerfrom">
           <mat-datepicker-toggle matSuffix [for]="myDatepickerfrom"></mat-datepicker-toggle>
           <mat-datepicker #myDatepickerfrom></mat-datepicker>
       </mat-form-field> -->
                <div class="w-100"
                    [ngClass]="{'disable-question-field disable-question-field-opacity': ( question?.isQuestionDisabled ) }">
                    <label class="" for="{{question.order}}">{{question.title}}
                        <span *ngIf="question.required" class="text-primary">*</span>
                    </label>
                    <input type="date" autocomplete="{{question.order}}" id="{{question.order}}" class="form-control "
                        placeholder="{{question.title}}" [ngClass]="{'invalid-border': question.errorMessage}"
                        name="{{question.order}}" [(ngModel)]="question.modelValue"
                        (change)="onChange(question, $event)" [ngModelOptions]="{standalone: true}"
                        [readonly]="question?.isQuestionDisabled" [min]="question?.min" [max]="question?.max"
                        (keydown)="restrictManuallyEnterDate()">
                    <mat-icon class="input-eye-icon" *ngIf="question?.information" [matTooltip]="question?.information"
                        style="right: 50px;">info</mat-icon>
                </div>
                <div class="col-sm-12 font-weight-500 text-primary error-msg" *ngIf="question.errorMessage">
                    {{question.information?question.information:question.errorMessage}}
                </div>
            </div>

            <!-- [ngClass]="{'col-sm-12': ( question.width == '100' || isOpenChevron ), 'col-sm-6': (question.width == '50' && !isOpenChevron ) || ( question.width == '25' && isOpenChevron ) , 'col-sm-3': ( question.width == '25' && !isOpenChevron ), 'invalid-border-class': ( question.errorMessage ), 'custom-col-sm-2': ( question.width == '20' && !isOpenChevron ) }" -->
            <div class="common-font-family customDropDown col-sm-12" *ngSwitchCase="QUESTION_TYPE.NESTED_ONE">
                <div class="d-flex justify-content-between w-100">
                    <mat-form-field class="w-100"
                        [ngClass]="{'disable-question-field': ( question?.isQuestionDisabled ) }">
                        <mat-label>{{question.title}}
                            <span *ngIf="question.required" class="text-primary">*</span>
                        </mat-label>

                        <mat-select id="{{question.order}}" [(value)]="question.modelValue"
                            [disableOptionCentering]="true" panelClass="custom-mat-select-panel"
                            (closed)="onSelectionClose(question?.order)" [disabled]="question?.isQuestionDisabled"
                            (selectionChange)="getSelectionChange(question, $event)">
                            <div class="w-100 shadow-sm search-filter">
                                <span class="">
                                    <input id="{{question.order+'_dropDownSearch'}}" type="text" class="form-control"
                                        placeholder="Search {{question.title}}" appRestrictFirstCharAsSpace
                                        appAlphabetOnly [(ngModel)]="searchedText"
                                        (ngModelChange)="getFilterAnswerOption($event, question);"
                                        (keydown)="$event.stopPropagation()">
                                </span>
                            </div>
                            <div class="single-select custom-y-scroll">
                                <mat-option *ngIf="question?.answer_option?.length == 0" disabled>No options available
                                </mat-option>
                                <mat-option *ngFor="let opt of question?.answer_option; trackBy:optionIdentity;"
                                    [value]="opt?._id" [disabled]="opt?.disabled" class="mb-2"
                                    [matTooltip]="opt.category ? opt.category : opt.name"
                                    (click)="opt?.disabled ? '' : onChange(question, {target: {value: opt._id, isSelected: true}})">
                                    <div class="d-flex flex-column mt-2" style="line-height: 1.2em;">
                                        <span>{{ opt.category ? opt.category : opt.name }}</span>
                                        <span *ngIf="opt && opt.info" matTooltip="{{opt?.info}}"
                                            class="option-info mt-1 text-truncate">{{opt?.info}}</span>
                                    </div>
                                </mat-option>
                            </div>
                        </mat-select>
                        <mat-icon class="input-eye-icon" *ngIf="question?.information"
                            [matTooltip]="question?.information" style="font-size: 16px; right: 15px;">info</mat-icon>
                    </mat-form-field>
                    <!-- <div *ngIf="question?.showComment" class="mb-1">
                         <span class="commentSelector" *ngIf="!pdfbuttonhide">
                             <app-show-comments (lastComment)="lastComment($event)" [location]="question?.commentApi" [lineItemId]="question?.commentLineItemId" [comment]="comments"></app-show-comments>
                         </span>
                     </div> -->
                </div>

                <!-- <span class="has-float-label" [ngClass]="{'disable-question-field': ( question?.isQuestionDisabled ) }">
             <select id="{{question.order}}" placeholder="{{question.title}}" (change)="onChange(question, $event)"
               name="question.modelValue" class="form-control "
               [ngClass]="{'invalid-border': question.errorMessage}" [(ngModel)]="question.modelValue">
               <option class="" value="" disabled>Select Option
               </option>
               <option class="" [value]="opt._id" *ngFor="let opt of question.answer_option;let i=index"
                 [hidden]="opt?.disabled">{{opt.name}}
               </option>
             </select>
             <label class="" for="{{question.order}}">{{question.title}} <span *ngIf="question.required"
                 class="text-primary">*</span></label>
                 <mat-icon class="input-eye-icon" *ngIf="question?.hint" [matTooltip]="question?.hint">info</mat-icon>
                 </span> -->
                <div class="col-sm-12  font-weight-500 text-primary error-msg" *ngIf="question.errorMessage">
                    {{question.information?question.information:question.errorMessage}}
                </div>
            </div>

            <div class="common-font-family mb-3"
                [ngClass]="{'col-sm-12': ( question.width == '100' || isOpenChevron ), 'col-sm-6': (question.width == '50' && !isOpenChevron ) || ( question.width == '25' && isOpenChevron ) , 'col-sm-3': ( question.width == '25' && !isOpenChevron ), 'custom-col-sm-2': ( question.width == '20' && !isOpenChevron ) }"
                *ngSwitchCase="QUESTION_TYPE.MULTI_SELECT_CHECKBOX">
                <div class="col-sm-12 mb-3 " id="{{question.order}}"
                    [ngClass]="{'invalid-border': question.errorMessage}">
                    {{question.title}}
                    <span *ngIf="question.required" class="text-primary">*</span>
                    <mat-icon class="radio-info-icon" *ngIf="question?.information"
                        [matTooltip]="question?.information">info</mat-icon>
                </div>
                <div class="col-sm-12" *ngFor="let option of question.answer_option;let i=index"
                    [ngClass]="{'disable-question-field': ( question?.isQuestionDisabled ) }">
                    <mat-checkbox class="m-3 " (change)="onChange(question, $event, option)" [checked]="option.checked">
                        {{option.name}}</mat-checkbox>
                </div>
                <div class="col-sm-12 font-weight-500 text-primary error-msg" *ngIf="question.errorMessage">
                    {{question.hint?question.hint:question.errorMessage}}
                </div>
            </div>

            <div class="common-font-family col-sm-6 customDropDown" *ngSwitchCase="QUESTION_TYPE.NESTED_TWO">
                <!-- <div class="col-sm-12 mb-3 " id="{{question.order}}" [ngClass]="{'invalid-border': question.errorMessage}">
                     {{question.title}}
                     <span *ngIf="question.required" class="text-primary">*</span>
                     <mat-icon class="radio-info-icon" *ngIf="question?.information" [matTooltip]="question?.information">info</mat-icon>
                 </div>
                 <div class="col-sm-12" *ngFor="let option of question.answer_option;let i=index" [ngClass]="{'disable-question-field': ( question?.isQuestionDisabled ) }">
                     <mat-checkbox class="m-3 " (change)="onChange(question, $event, option)" [checked]="option.checked">{{option.name}}</mat-checkbox>

                 </div>
                 <div class="col-sm-12 font-weight-500 text-primary error-msg" *ngIf="question.errorMessage">
                     {{question.information?question.information:question.errorMessage}}
                 </div> -->
                <label for="{{question.order}}">{{question.title}}<span *ngIf="question.required"
                        class="text-primary">*</span></label>

                <div class="d-flex justify-content-between w-100">
                    <mat-form-field class="w-100"
                        [ngClass]="{'disable-question-field': ( question?.isQuestionDisabled ) }" floatLabel="never">
                        <mat-label>{{question.hint ? question.hint : "Select Answer" }}
                        </mat-label>
                        <mat-select id="{{question.order}}" panelClass="custom-mat-select-panel" multiple
                            [(ngModel)]="question.value" [disableOptionCentering]="true"
                            (closed)="onSelectionClose(question?.order)" [disabled]="question?.isQuestionDisabled">
                            <div class="w-100 shadow-sm search-filter">
                                <!-- has-float-label - use this class in span tag and comment the label for floating label field -->
                                <span class="">
                                    <input id="{{question.order+'_dropDownSearch'}}" type="text" class="form-control"
                                        placeholder="Search {{question.title}}" appRestrictFirstCharAsSpace
                                        appAlphabetOnly [(ngModel)]="searchedText"
                                        (ngModelChange)="getFilterAnswerOption($event, question);"
                                        (keydown)="$event.stopPropagation()">
                                    <!-- <label for="{{question.order+'_dropDownSearch'}}">Search {{question.title}}</label> -->
                                </span>
                            </div>
                            <div class="single-select custom-y-scroll">
                                <mat-option *ngIf="question?.answer_option?.length == 0" disabled>No options available
                                </mat-option>
                                <mat-option *ngFor="let option of question?.answer_option; let i=index"
                                    [value]="option._id" [disabled]="option?.disabled" [matTooltip]="option?.name"
                                    class="mb-2"
                                    (click)="option?.disabled ? '' : onChange(question, {checked: !option.checked}, option)">
                                    <!-- {{option?.name}} -->
                                    <div class="d-flex flex-column mt-2" style="line-height: 1.2em;">
                                        <span>{{ option?.name }}</span>
                                        <span *ngIf="option && option.info" matTooltip="{{option?.info}}"
                                            class="option-info mt-1 text-truncate">{{option?.info}}</span>
                                    </div>
                                </mat-option>
                            </div>
                        </mat-select>
                        <mat-icon class="input-eye-icon" *ngIf="question?.information"
                            [matTooltip]="question?.information" style="font-size: 16px; right: 20px;">info</mat-icon>
                    </mat-form-field>
                    <!-- <div *ngIf="question?.showComment" class="mb-1">
                         <span class="commentSelector" *ngIf="!pdfbuttonhide">
                             <app-show-comments (lastComment)="lastComment($event)" [location]="question?.commentApi" [lineItemId]="question?.commentLineItemId" [comment]="comments"></app-show-comments>
                         </span>
                     </div> -->
                </div>

                <div class="col-sm-12  font-weight-500 text-primary error-msg" *ngIf="question.errorMessage">
                    {{question.information?question.information:question.errorMessage}}
                </div>
            </div>


            <div class="common-font-family mb-3 col-sm-12" *ngSwitchCase="QUESTION_TYPE.LABEL">
                <!-- <div class="col-sm-12 mb-3 " [innerHTML]="question.title | safe: 'html'" id="{{question.order}}" [ngClass]="{'invalid-border': question.errorMessage}"> -->
                <div class="d-flex"
                    style="border-radius: 4px 4px 0 0;background:#d3d3d3; padding:12px; font-weight:600;"
                    id="{{question.order}}" [ngClass]="{'invalid-border': question.errorMessage}"> {{question?.title}}
                    <!-- <div *ngIf="question?.showComment" class="technicalComments">
                         <span class="commentSelector" *ngIf="!pdfbuttonhide">
                             <app-show-comments (lastComment)="lastComment($event)" [location]="question?.commentApi" [lineItemId]="question?.commentLineItemId" [comment]="comments"></app-show-comments>
                         </span>
                     </div> -->
                     <mat-icon class="mat-info-icon" *ngIf="question?.information"
                     [matTooltip]="question?.information" style="font-size: 16px; right: 15px;">info</mat-icon>
                </div>
            </div>


            <div class="common-font-family col-sm-12" *ngSwitchDefault>
                <div class="mb-3 " *ngIf="question?.title">{{question.title}} <span *ngIf="question.required"
                        class="text-primary">*</span>
                </div>

                <ng-container *ngIf="!question?.title">
                    <div class="row mx-1">
                        <!-- <div class="col-sm-12" *ngIf="value">{{value}}</div> -->
                        <ng-container *ngFor="let child of question;  let questionIndexes = index"
                            [ngTemplateOutlet]="treeNode"
                            [ngTemplateOutletContext]="{ question: child, questionIndex:questionIndexes, value: []}">
                        </ng-container>
                    </div>
                </ng-container>
            </div>
        </ng-container>
        <!-- <div class="col-sm-12 font-weight-500 text-primary error-msg" *ngIf="question.errorMessage">
         {{question.hint?question.hint:question.errorMessage}}
       </div> -->

        <ng-container *ngIf="question?.childQuestionData">
            <div class="common-font-family col-sm-12">
                <ng-container *ngFor="let child of question.childQuestionData;  let questionIndexes = index"
                    [ngTemplateOutlet]="treeNode"
                    [ngTemplateOutletContext]="{ question: child, questionIndex:questionIndexes, value: [question.value[questionIndexes]]}">
                    <!-- {{question.childQuestionData | json}} -->
                    <div style="border-radius: 4px 4px 0 0;
                     background: #d3d3d3;
                     padding: 12px;
                     font-family: saira;
                     font-weight: 600;" class="w-100 mr-4 d-flex justify-content-between ml-4 mb-3">
                        <span>{{question.input_type == QUESTION_TYPE.NESTED_ONE ? question.title+ ' ' + (questionIndexes
                            + 1) :child[0]?.selectedAnswerOption?.name}}</span>
                        <!-- <div *ngIf="question?.showComment" class="mr-3">
                             <span class="commentSelector" *ngIf="!pdfbuttonhide">
                                 <app-show-comments (lastComment)="lastComment($event)" [location]="question?.commentApi" [lineItemId]="question?.commentLineItemId" [comment]="comments"></app-show-comments>
                             </span>
                         </div> -->
                    </div>
                </ng-container>
            </div>
        </ng-container>


    </ng-template>

    <!-- <div class="custom-loader" *ngIf="isImageUploading">
        <mat-spinner mode="indeterminate"></mat-spinner>
    </div> -->
</ng-container>


<ng-container *ngIf="!isViewMode && viewFormTemplate == 'dur' && showForm">
    <mat-card class="custom-shadow dur dur-overflow">
        <div class="row">
            <div class="col-sm-12">
                <div class="d-flex justify-content-end me-3">
                    <button class="btn btn-primary" (click)="showPreview()">Preview</button>
                </div>
                <p class="desc" *ngIf="formDescription">{{formDescription}}</p>
                <div class="row mb-3" *ngIf="showFormChange">
                    <div class="col-sm-8 px-0">
                        <input type="text" autocomplete="name" name="name" class="form-control" [(ngModel)]="formId"
                            placeholder="Enter Form Id and then press Submit" [ngModelOptions]="{standalone: true}" />
                    </div>
                    <div class="col-sm-2"><button class="btn btn-sm btn-primary text-uppercase "
                            (click)="onChangeForm()">Submit</button></div>
                </div>

                <div class="row mt-3">
                    <div class="col-sm-6" [ngClass]="isOpenChevron ? 'col-sm-6' : 'col-sm-12'">
                        <i *ngIf="showPreviewAnswer" class="fa fa-chevron-circle-left chevron-right"
                            (click)="isOpenChevron = !isOpenChevron"></i>
                        <!-- <div class="col-sm-12 mb-5 card p-3">{{formtitle}}</div> -->



                        <div class="">
                            <div class="row" style="align-items:end;">
                                <!-- As the references change ngFor will continuously regenerate the DOM
               However, the presence of trackBy provides ngFor some help.
               It modifies the behavior so that it compares new data to old based on
               the return value of the supplied trackBy method.
               This allows Angular to reduce the amount of DOM update needed -->
                                <!-- myfilter => myfilter is used to filter out visible question -->
                                <ng-container
                                    *ngFor="let question of questionData | myfilter; trackBy:identity; let questionIndex = index"
                                    [ngTemplateOutlet]="treeNode"
                                    [ngTemplateOutletContext]="{ question: question, questionIndex:questionIndex, value: [] }">
                                </ng-container>
                            </div>
                        </div>

                    </div>
                    <div class="col-sm-6 float-left" *ngIf="isOpenChevron">
                        <div class="col-sm-12 mb-3 card p-3 ">Preview Answers</div>
                        <div class="col-sm-12 font-weight-500">{{completedLenegth()}}</div>
                        <div class="col-sm-12 card mt-2 p-3"
                            *ngFor="let question of questionData; let answerIndex = index"
                            [ngClass]="{'d-none': !question.selectedValue || (question.selectedValue && question.selectedValue.length == 0)}">
                            <div class="row" *ngIf="question?.selectedValue?.length">
                                <div class="col-sm-12 mb-3 " style="font-size: 90%;">
                                    {{answerIndex+1}}. {{question.title}}
                                </div>
                                <div class="col-sm-12 font-weight-500" style="font-size: 90%;">
                                    <div
                                        *ngIf="question.answer_option && question.answer_option.length; else defaultAnswer">
                                        <div class="col-sm-12 text-justify">Answers</div>
                                        <ul>
                                            <li *ngFor="let answer of question.selectedValue">
                                                {{answer.label}} {{answer.textValue}}
                                            </li>
                                        </ul>
                                    </div>
                                    <ng-template #defaultAnswer>
                                        <div class="col-sm-12  font-weight-500 text-justify" style="font-size: 90%;">
                                            Answer:
                                            <span *ngIf="(question?.acceptableType == 'image/*') && (question?.value)">
                                                <img class="mx-1"
                                                    [src]="question?.imgUrl ? question?.imgUrl : question?.value"
                                                    height="60" width="60" style="object-fit:contain; display: block;">
                                            </span> {{question?.selectedValue[0]?.textValue ?
                                            question?.selectedValue[0]?.textValue : question?.selectedValue[0]?.value}}
                                        </div>
                                    </ng-template>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- formId 6 is for 28slb -->
        <p class="p-4" *ngIf="questionresponse?.data[0]?.formId == '6' && questionresponse?.data[0]?.createdIn2122">Click <a style="color: blue;"
                href="{{slbFormURL}}">Here</a> to view your performance against the 4 SLBs</p>
        <div class="d-flex justify-content-end" *ngIf="showSubmitButton && isButtonDisplay">
            <div class="row w-100">
                <!-- save, draft, pre and next button -->

                <div class="col-sm-6" *ngIf="!hidePreviousButton">
                    <button class="btn btn-pre" (click)="nextPrevBtnCall('pre')">
                        <- Previous Form </button>
                </div>
                <div class="d-flex justify-content-end" [ngClass]="hidePreviousButton ? 'col-sm-12' : 'col-sm-6'">
                    <div class="d-inline-flex mr1" *ngIf="showDraftButton">
                        <button class="btn btn-save text-uppercase"
                            [disabled]="isImageUploading || questionresponse?.data[0]?.language[0].isQuestionDisabled"
                            (click)="beforeSubmitPrepareResponse(true)" *ngIf="!pdfbuttonhide">
                            Save as Draft
                        </button>
                    </div>
                    <div class="d-inline-flex mr1" *ngIf="showSubmitButton">
                        <button class="btn btn-save text-uppercase"
                            [disabled]="isImageUploading || questionresponse?.data[0]?.language[0].isQuestionDisabled"
                            (click)="beforeSubmitPrepareResponse()" *ngIf="!pdfbuttonhide">
                            {{buttonText}}
                        </button>
                    </div>
                    <div class="d-inline-flex " *ngIf="!hideNextButton">
                        <button class="btn btn-next text-uppercase" (click)="nextPrevBtnCall('next')">
                            Next Form ->
                        </button>
                    </div>
                </div>
            </div>
            <!-- <button class="btn btn-sm btn-primary text-uppercase"
                [disabled]="isImageUploading || isFormSubmittedSuccessfully" (click)="beforeSubmitPrepareResponse()"
                *ngIf="!pdfbuttonhide">
                {{buttonText}}
            </button> -->
        </div>
    </mat-card>
    <div class="row container" *ngIf="disclaimerMessage">
        <span class="text-primary">{{disclaimerMessage}}</span>
    </div>

    <!-- { question: child, questionIndex:questionIndexes, value: [question.value[questionIndexes]]} -->

    <ng-template #treeNode let-question="question" let-questionIndex="questionIndex" let-value="value"
        let-tablular="tablular" let-parent="parent" let-loopIndex="loopIndex">
        <!-- <p> {{ question?.information | json }}</p> -->
        <ng-container class="row mt-2" [ngSwitch]="question?.input_type">
            <!-- condition for different col-width "col-sm-6" for 25 when isOpenChevron is true ( open ) -->
            <!-- [ngClass]="{'col-sm-12': ( question.width == '100' || isOpenChevron ) && question.width != '25' , 'col-sm-6': (question.width == '50' && !isOpenChevron ) || ( question.width == '25' && isOpenChevron ) , 'col-sm-3': ( question.width == '25' && !isOpenChevron ) }" -->
            <!-- [ngClass]="{'col-sm-12': ( question.width == '100' || isOpenChevron ), 'col-sm-6': (question.width == '50' && !isOpenChevron ) || ( question.width == '25' && isOpenChevron ) , 'col-sm-3': ( question.width == '25' && !isOpenChevron ), 'custom-col-sm-2': ( question.width == '20' && !isOpenChevron ) }" -->
            <div class="common-font-family col-12 d-flex align-items-baseline" *ngSwitchCase="QUESTION_TYPE.TEXT">
                <div *ngIf="!tablular" class="d-flex justify-content-between label-wrapper my-2 py-1 ps-3 rounded w-75">
                    <label for="{{question.order}}">{{question.title}}<span *ngIf="question?.required"
                            class="text-primary">*</span>
                        <mat-icon *ngIf="question?.information" style="font-size: medium;"
                            [matTooltip]="question?.information">info</mat-icon>
                    </label>
                    <!-- <div *ngIf="question?.showComment" class="mr-3">
                         <span class="commentSelector" *ngIf="!pdfbuttonhide">
                             <app-show-comments (lastComment)="lastComment($event)" [location]="question?.commentApi" [lineItemId]="question?.commentLineItemId" [comment]="comments"></app-show-comments>
                         </span>
                     </div> -->
                </div>
                <span [ngClass]="{'disable-question-field disable-question-field-opacity': ( question?.isQuestionDisabled ),
                    'w-25': !tablular ,
                    'w-100': tablular,
                    'ms-2': !tablular }">
                    <p *ngIf="question.showAsText" style="color: black;">{{ question.modelValue }}</p>
                    <input *ngIf="!question.showAsText" type="{{question?.passwordMode ? 'password' : 'text'}}"
                        autocomplete="{{question.order}}" name="{{question.order}}" appAlphanumeric
                        class="form-control " pattern="{{question?.pattern}}" placeholder="{{question?.hint}}"
                        minlength="{{question.min}}" appRestrictFirstCharAsSpace
                        [ngClass]="{'invalid-border': question.errorMessage}" maxlength="{{question.max}}"
                        id="{{(question?.forParentValue) ? question?.forParentValue : question.order}}"
                        [value]="question.modelValue ? question.modelValue : ''" (change)="onChange(question, $event)"
                        [ngModelOptions]="{standalone: true}" (focus)="onFocusEvent(question.order, question)"
                        [readonly]="question?.isQuestionDisabled"  [appNumberLength]="question.max"/>
                    <ng-container *ngIf="question?.isPassword">
                        <i *ngIf="!question?.passwordMode" [matTooltip]="'Hide'"
                            (click)="question.passwordMode = !question.passwordMode"
                            class="fa fa-eye passwordShowHide pointer-hand" aria-hidden="true"></i>
                        <i *ngIf="question?.passwordMode" [matTooltip]="'Show'"
                            (click)="question.passwordMode = !question.passwordMode"
                            class="fa fa-eye-slash passwordShowHide pointer-hand" aria-hidden="true"></i>
                    </ng-container>
                    <!-- <label class="" for="{{question.order}}">{{question.title}} <span *ngIf="question.required"
                 class="text-primary">*</span></label> -->
                    <div class="col-sm-12  font-weight-500 text-primary error-msg" *ngIf="question.errorMessage">
                        {{question.information?question.information:question.errorMessage}}
                    </div>
                    <mat-icon class="input-eye-icon" *ngIf="question?.information" [matTooltip]="question?.information">
                        info</mat-icon>
                </span>
                <div *ngIf="(question?.labelInstruction) && (!question.errorMessage)" class="label-instruction">
                    <em>* {{question?.labelInstruction}}</em>
                </div>

            </div>

            <!-- [ngClass]="{'col-sm-12': ( question.width == '100' || isOpenChevron ), 'col-sm-6': (question.width == '50' && !isOpenChevron ) || ( question.width == '25' && isOpenChevron ) , 'col-sm-3': ( question.width == '25' && !isOpenChevron ), 'custom-col-sm-2': ( question.width == '20' && !isOpenChevron ) }" -->
            <div class="common-font-family mb-3 col-sm-6" *ngSwitchCase="QUESTION_TYPE.ADDRESS">
                <!-- <input type="text" class="form-control" minlength="{{question.min}}" [ngClass]="{'invalid-border': question.errorMessage}" maxlength="{{question.max}}" id="{{question.order}}" [value]="question.modelValue ? question.modelValue : ''" (change)="onChange(question, $event)" [ngModelOptions]="{standalone: true}" /> -->
                <div class="d-flex justify-content-between">
                    <label for="{{question.order}}">{{question.title}}<span *ngIf="question.required"
                            class="text-primary">*</span></label>
                    <!-- <div *ngIf="question?.showComment" class="mr-3">
                         <span class="commentSelector" *ngIf="!pdfbuttonhide">
                             <app-show-comments (lastComment)="lastComment($event)" [location]="question?.commentApi"
                                 [lineItemId]="question?.commentLineItemId" [comment]="comments"></app-show-comments>
                         </span>
                     </div> -->
                </div>
                <span class="" [ngClass]="{'disable-question-field': ( question?.isQuestionDisabled ) }">
                    <textarea [appAlphabetOnly]="unBlockCharObject" autocomplete="{{question.order}}"
                        [wordLimit]="question" class="form-control " placeholder="{{question?.hint}}"
                        minlength="{{question.min}}" [ngClass]="{'invalid-border': question.errorMessage}"
                        maxlength="{{question.max}}" id="{{question.order}}" name="{{question.order}}"
                        [value]="question.modelValue ? question.modelValue : ''" (change)="onChange(question, $event)"
                        [ngModelOptions]="{standalone: true}" style="height: 80px"
                        (focus)="onFocusEvent(question.order, question)" appRestrictFirstCharAsSpace
                        [readonly]="question?.isQuestionDisabled">
             </textarea>
                    <mat-icon class="input-eye-icon" *ngIf="question?.information" [matTooltip]="question?.information">
                        info</mat-icon>
                </span>
                <div class="col-sm-12  font-weight-500 text-primary error-msg" *ngIf="question.errorMessage">
                    {{question.information?question.information:question.errorMessage}}
                </div>
            </div>

            <!-- [ngClass]="{'col-sm-12': ( question.width == '100' || isOpenChevron ), 'col-sm-6': (question.width == '50' && !isOpenChevron ) || ( question.width == '25' && isOpenChevron ) , 'col-sm-3': ( question.width == '25' && !isOpenChevron ), 'custom-col-sm-2': ( question.width == '20' && !isOpenChevron ) }" -->
            <div class="common-font-family col-12 d-flex align-items-baseline" *ngSwitchCase="QUESTION_TYPE.NUMERIC">
                <div class="d-flex justify-content-between label-wrapper  my-2 py-1 ps-3 rounded w-75"
                    *ngIf="!tablular">
                    <label class="" for="{{question.order}}">{{question.title}} <span *ngIf="question.required"
                            class="text-primary">*</span>
                        <mat-icon *ngIf="question?.information" style="font-size: medium;"
                            [matTooltip]="question?.information">info</mat-icon>
                    </label>
                    <!-- <div *ngIf="question?.showComment" class="mr-3">
                         <span class="commentSelector" *ngIf="!pdfbuttonhide">
                             <app-show-comments (lastComment)="lastComment($event)" [location]="question?.commentApi"
                                 [lineItemId]="question?.commentLineItemId" [comment]="comments"></app-show-comments>
                         </span>
                     </div> -->
                </div>
                <div style="position: relative;" [ngClass]="{
                        'w-25': !tablular,
                        'w-100': tablular,
                        'ms-2': !tablular }">
                    <div class="d-flex">
                        <input digitOnly [decimal]="!(question?.title == 'Number of Projects Undertaken')" appDisableNagetive [appDecimalLimit]="question.allowDecimal == false ? 0 : 2"
                            type="number" class="form-control " [appMaxRange]="question"
                            [questionData]="questionData"
                            placeholder="{{question.hint}}" [ngClass]="{
                                'disable-question-field': ( question?.isQuestionDisabled ),
                                'invalid-border': question.errorMessage,
                                'warning-border': question?.isFocused && question.shortKey | durCustomWarnings : question: questionData : questionIndex
                            }" minlength="{{question.min}}" id="{{question.order}}" [value]="question.modelValue"
                            (input)="onChange(question, $event)" 
                            (paste)="onChange(question, $event)" 
                            (change)="onChange(question, $event)"
                            [ngModelOptions]="{standalone: true}" (focus)="onFocusEvent(question.order, question)"
                            onwheel="this.blur()" (blur)="onBlurEvent(question)"
                            [appRestrictFirstDigitAsZero]="question?.minRange"
                            [readonly]="question?.isQuestionDisabled" title="" step="any" autocomplete="off"/>

                        <p *ngIf="question.shortKey | slb28Unit : parent : loopIndex"
                            class="rounded slb28unit bg-primary px-2 py-1 ms-1">{{ question.shortKey | slb28Unit :
                            parent :
                            loopIndex}}</p>

                    </div>
                    <!-- <mat-icon class="input-eye-icon" *ngIf="!tablular && question?.information" [matTooltip]="question?.information">
                        info</mat-icon> -->


                    <div class="col-sm-12  font-weight-500 text-primary error-msg" *ngIf="question.errorMessage">
                        {{question.errorMessage? question.errorMessage : question.information}}
                    </div>
                    <mat-icon class="input-warning-icon"
                        *ngIf="question?.isFocused && question.shortKey | durCustomWarnings : question: questionData : loopIndex"
                        [matTooltip]="question.shortKey | durCustomWarnings : question: questionData: loopIndex">warning
                    </mat-icon>
                    <small *ngIf="question.modelValue">{{ question.modelValue | toWord: question.shortKey : form
                        }}</small>
                    <small class="error-msg d-block"
                        *ngIf="finalSubmitted && (question.shortKey | durCustomErrors : parent : questionData: loopIndex)">{{
                        question.shortKey | durCustomErrors : parent: questionData: loopIndex }}</small>
                    <small class="error-msg d-block"
                        *ngIf="finalSubmitted && (question.shortKey | slb28CustomErrors : parent: questionData: loopIndex : question.minRange)">{{
                        question.shortKey | slb28CustomErrors : parent: questionData: loopIndex : question.minRange
                        }}</small>
                    <small class="error-msg d-block"
                        *ngIf="finalSubmitted && (question.shortKey | gtcCustomErrors : parent : questionData: loopIndex)">{{
                        question.shortKey | gtcCustomErrors : parent: questionData: loopIndex }}</small>
                </div>
                <div *ngIf="(question?.labelInstruction) && (!question.errorMessage)" class="label-instruction">
                    <em>* {{question?.labelInstruction}}</em>
                </div>

            </div>


            <div class="common-font-family mb-3 col-6" *ngSwitchCase="QUESTION_TYPE.GPS">
                <!-- <input type="text" [value]="question.modelValue" (change)="onChange(question, $event)"> -->
                <!-- <p>{{ question.modelValue | json }}</p> -->
                <app-location-picker [question]="question" [disabled]="question?.isQuestionDisabled"
                    (onQuestionUpdate)="onChange(question, $event)">
                </app-location-picker>
                <div class="col-sm-12  font-weight-500 text-primary error-msg"
                    *ngIf="finalSubmitted && (!question.modelValue || question.modelValue == ',' || question.modelValue == '0,0' || question.modelValue == ',0' || question.modelValue == '0,')">
                    Location is required
                </div>
            </div>


            <div class="common-font-family mb-3 col-12" *ngSwitchCase="QUESTION_TYPE.CONSENT">
                <div class="d-flex">
                    <input type="checkbox" [checked]="question.modelValue == '1'"
                        [disabled]="question?.isQuestionDisabled" (change)="onChange(question, $event)">
                    <p class="mb-0 ms-2">{{ question.title }}</p>
                </div>
            </div>

            <!-- <div class="mb-3" [ngClass]="{'col-sm-12': ( question.width == '100' || isOpenChevron ), 'col-sm-6': (question.width == '50' && !isOpenChevron ) || ( question.width == '25' && isOpenChevron ) , 'col-sm-3': ( question.width == '25' && !isOpenChevron ), 'custom-col-sm-2': ( question.width == '20' && !isOpenChevron ) }"
                 *ngSwitchCase="QUESTION_TYPE.RADIO"> -->
            <div class="common-font-family col-12 my-1" *ngSwitchCase="QUESTION_TYPE.RADIO">
                <div class="common-font-family w-100  d-flex align-items-baseline">
                    <div class="d-flex justify-content-between label-wrapper  my-2 py-1 ps-3 rounded w-75"
                        [ngClass]="{'invalid-border': question.errorMessage,'disable-question-field': question?.isQuestionDisabled }"
                        style="font-size: 90%;" *ngIf="!tablular">
                        {{question.title}}
                        <span *ngIf="question.required" class="text-primary">*</span>
                        <mat-icon class="radio-info-icon" *ngIf="question?.information"
                            [matTooltip]="question?.information">info</mat-icon>
                    </div>
                    <div class="" style="min-width: 110px;" [ngClass]="{
                        'w-25': !tablular,
                        'w-100': tablular,
                        'ms-2': !tablular }">
                        <mat-radio-group aria-label="Select an option"
                            [ngClass]="{'disable-question-field': ( question?.isQuestionDisabled ) }"
                            [disabled]="question?.isQuestionDisabled">
                            <mat-radio-button style="font-size: 11px; margin-bottom: 2px;" class="mr-1"
                                [disabled]="option?.disabled" *ngFor="let option of question.answer_option;let i=index"
                                [value]="option._id" [checked]="option._id == question.modelValue"
                                (change)="onChange(question, $event, option)">
                                {{option?.name}}</mat-radio-button>
                        </mat-radio-group>
                        <div class="col-6  font-weight-500 text-primary error-msg" *ngIf="question.errorMessage">
                            {{question.errorMessage? question.errorMessage : question.information}}
                        </div>
                    </div>
                </div>
                <ng-container *ngFor="let warning of question?.warnings">
                    <p *ngIf="warning?.on == question?.modelValue" class="text-danger">{{ warning?.message }}</p>
                </ng-container>
            </div>

            <!-- [ngClass]="{'col-sm-12': ( question.width == '100' || isOpenChevron ), 'col-sm-6': (question.width == '50' && !isOpenChevron ) || ( question.width == '25' && isOpenChevron ) , 'col-sm-3': ( question.width == '25' && !isOpenChevron ), 'custom-col-sm-2': ( question.width == '20' && !isOpenChevron ) }" -->
            <div class="common-font-family col-12" *ngSwitchCase="QUESTION_TYPE.FILE_UPLOAD">
                <div class="common-font-family d-flex align-items-baseline">
                    <div class="d-flex justify-content-between label-wrapper  my-2 py-1 ps-3 rounded w-75"
                        style="font-size: 90%; color: #6c757d;" *ngIf="!tablular">
                        <div class="{{question?.shortKey }}">
                            {{question.title}}
                            <span *ngIf="question.required" class="text-primary">*</span>
                            <mat-icon class="file-type-info" *ngIf="question?.information"
                                [matTooltip]="question?.information">info</mat-icon>
                        </div>
                        <!-- <div *ngIf="question?.showComment" class="mr-3">
                             <span class="commentSelector" *ngIf="!pdfbuttonhide">
                                 <app-show-comments (lastComment)="lastComment($event)" [location]="question?.commentApi" [lineItemId]="question?.commentLineItemId" [comment]="comments"></app-show-comments>
                             </span>
                         </div> -->
                    </div>
                    <div class="" [ngClass]="{
                        'w-25': !tablular,
                        'w-100': tablular,
                        'ms-2': !tablular }">
                        <div class="btn btn-upload" (click)="imageInputClickHandler($event, question)"
                            [ngClass]="{'disable-question-field': ( question?.isQuestionDisabled ) }">
                            <input type="file" id="{{question.order}}{{formIdentifier}}" class="form-control d-none"
                                [accept]="question?.acceptableType" (change)="docsInputChangeHandler($event, question)"
                                style="background-color: white !important; border-bottom: 0 !important">
                            <label class=" pointer-hand" for="customFile"
                                [ngClass]="{'invalid-border': question.errorMessage}">Choose file</label>
                        </div>
                        <div class="row" *ngIf="question?.selectedValue?.length">
                            <ng-container *ngFor="let file of question?.selectedValue">
                                <p class="col-8 file-name mt-2" *ngIf="file?.value && (question?.shortKey != 'cert_declaration')">{{ file?.label }}</p>
                                <div class="col-2 mt-2" *ngIf="file?.value">
                                    <a target="_blank" href="{{file?.value | toStorageUrl}}">
                                        <span
                                            class="file-icon position-relative pointer-hand material-icons {{ file?.label }}"
                                            matTooltip="Click to view the file, Name: {{file?.label}}"
                                            matTooltipClass="tooltip-red">
                                            cloud_download
                                        </span>
                                    </a>
                                </div>
                                <div *ngIf="file?.value && !question?.isQuestionDisabled"
                                    class="col-2 mt-2 me-0 ms-0 material-icons file-icon-cross pointer-hand"
                                    matTooltip="Remove the upload file"
                                    (click)="removeUploadedFile(question, question?.order)">cancel</div>
                            </ng-container>
                        </div>
                        <div class="col-sm-12  font-weight-500 text-primary error-msg" *ngIf="question.errorMessage">
                            {{question.hint?question.hint:question.errorMessage}}
                        </div>
                    </div>
                </div>
            </div>

            <!-- [ngClass]="{'col-sm-12': ( question.width == '100' || isOpenChevron ), 'col-sm-6': (question.width == '50' && !isOpenChevron ) || ( question.width == '25' && isOpenChevron ) , 'col-sm-3': ( question.width == '25' && !isOpenChevron ), 'invalid-border-class': ( question.errorMessage ), 'custom-col-sm-2': ( question.width == '20' && !isOpenChevron ) }" -->
            <div class="common-font-family customDropDown col-12 align-items-baseline {{form}}"
                *ngSwitchCase="QUESTION_TYPE.SINGLE_SELECT">
                <!-- <app-custom-dropdown [configuration]="question?.dropdownConfig" [datas]="question?.answer_option" (valueChanges)="onChange(question, {target: {value: $event.value}})"></app-custom-dropdown> -->
                <label for="{{question.order}}" *ngIf="!tablular"
                    class="d-flex justify-content-between label-wrapper  my-2 py-1 ps-3 rounded w-75">{{question.title}}<span
                        *ngIf="question.required" class="text-primary">*</span>
                    <mat-icon *ngIf="question?.information" style="font-size: medium;"
                        [matTooltip]="question?.information">info</mat-icon>
                </label>
                <mat-form-field style="position: relative;" class="d-block" [ngClass]="{
                        'disable-question-field': ( question?.isQuestionDisabled ),
                        'w-25': !tablular,
                        'w-100': tablular,
                        'ms-2': !tablular 
                    }" floatLabel="never">
                    <mat-label>{{question.hint}}
                    </mat-label>

                    <!-- [floatLabel]="isLoading ? 'never' : 'auto'" add this line mat-form-field -->
                    <!-- <mat-label *ngIf="!isLoading">{{question.title}}
             <span *ngIf="question.required" class="text-primary">*</span>
           </mat-label>

             <mat-label *ngIf="isLoading">
               <div class="select-placeholder-container">
                 <span>{{question.title}} Loading...</span>
                 <mat-spinner class="spinner" diameter="20"></mat-spinner>
               </div>
             </mat-label> -->
                    <!-- [disableOptionCentering]="true"    this is used to make options pannel position sticky  -->
                    <mat-select id="{{question.order}}" [(value)]="question.modelValue" [disableOptionCentering]="true"
                        panelClass="custom-mat-select-panel" (closed)="onSelectionClose(question?.order)"
                        [disabled]="question?.isQuestionDisabled"
                        (selectionChange)="getSelectionChange(question, $event)">
                        <div class="w-100 shadow-sm search-filter" *ngIf="question?.shortKey != 'dpr_status'">
                            <!-- has-float-label - use this class in span tag and comment the label for floating label field -->
                            <span class="">
                                <input id="{{question.order+'_dropDownSearch'}}" type="text" class="form-control"
                                    placeholder="Search {{question.title}}" appRestrictFirstCharAsSpace appAlphabetOnly
                                    [(ngModel)]="searchedText"
                                    (ngModelChange)="getFilterAnswerOption($event, question);"
                                    (keydown)="$event.stopPropagation()">
                                <!-- <label for="{{question.order+'_dropDownSearch'}}">Search {{question.title}}</label> -->
                            </span>
                        </div>
                        <div class="custom-y-scroll" [ngClass]="{'single-select' : question?.shortKey != 'dpr_status'}">
                            <mat-option *ngIf="question?.answer_option?.length == 0" disabled>No options available
                            </mat-option>
                            <mat-option *ngFor="let opt of question?.answer_option; trackBy:optionIdentity;"
                                [value]="opt?._id" [disabled]="opt?.disabled" class="mb-2"
                                [matTooltip]="opt.category ? opt.category : opt.name"
                                (click)="opt?.disabled ? '' : onChange(question, {target: {value: opt._id, isSelected: true}})">
                                <!-- {{opt.category ? opt.category : opt.name}} -->
                                <div class="d-flex flex-column mt-2" style="line-height: 1.2em;">
                                    <span>{{ opt.category ? opt.category : opt.name }}</span>
                                    <span *ngIf="opt && opt.info" matTooltip="{{opt?.info}}"
                                        class="option-info mt-1 text-truncate">{{opt?.info}}</span>
                                </div>
                            </mat-option>
                        </div>
                    </mat-select>
                    
                    <mat-icon class="input-eye-icon" *ngIf="question?.information" [matTooltip]="question?.information"
                        style="font-size: 16px; right: 15px;">info</mat-icon>
                </mat-form-field>
                <!-- <span class="has-float-label" [ngClass]="{'disable-question-field': ( question?.isQuestionDisabled ) }">
             <select id="{{question.order}}" placeholder="{{question.title}}" (change)="onChange(question, $event)"
               name="{{question.modelValue}}" class="form-control  font-weight-500"
               [(ngModel)]="question.modelValue" [ngClass]="{'invalid-border': question.errorMessage}">
               <option class="" value="" disabled>Select Option
               </option>

               <option class="" [value]="opt._id" *ngFor="let opt of question.answer_option; trackBy:optionIndentity; let i=index"
                 [hidden]="opt?.disabled">{{opt.category ? opt.category : opt.name}}
               </option>
             </select>
             <label class="" for="{{question.order}}">{{question.title}} <span *ngIf="question.required"
                 class="text-primary">*</span></label>
                 <mat-icon class="input-eye-icon" *ngIf="question?.hint" [matTooltip]="question?.hint">info</mat-icon>
           </span> -->
           
                <div class="col-sm-12  font-weight-500 text-primary error-msg" *ngIf="!question.modelValue && question.errorMessage"
                    style="">
                    {{question.hint ? question.hint : question.errorMessage}}
                </div>
            </div>

            <!-- Treating checkbox as multi select -->
            <!-- [ngClass]="{'col-sm-12': ( question.width == '100' || isOpenChevron ), 'col-sm-6': (question.width == '50' && !isOpenChevron ) || ( question.width == '25' && isOpenChevron ) , 'col-sm-3': ( question.width == '25' && !isOpenChevron ), 'invalid-border-class': ( question.errorMessage ), 'custom-col-sm-2': ( question.width == '20' && !isOpenChevron ) }" -->
            <div class="common-font-family customDropDown col-sm-6" *ngSwitchCase="QUESTION_TYPE.MULTI_SELECT">
                <label for="{{question.order}}">{{question.title}}<span *ngIf="question.required"
                        class="text-primary">*</span></label>
                <!-- <div class="col-sm-12 mb-3 " id="{{question.order}}" [ngClass]="{'invalid-border': question.errorMessage}">{{question.title}} <span *ngIf="question.required" class="text-primary">*</span></div>
         <div class="col-sm-12" *ngFor="let option of question.answer_option;let i=index">
           <mat-checkbox class="m-3  font-weight-500" (change)="onChange(question, $event, option)" [checked]="option.checked">{{option.name}}</mat-checkbox>
         </div> -->

                <!-- <ng-multiselect-dropdown [settings]="question.settings" [data]="question.answer_option" [(ngModel)]="question.selectedValue"
             (onSelect)="onItemSelect(question, $event)" (onDeSelect)="onItemDeSelect(question, $event)">
           </ng-multiselect-dropdown> -->
                <!-- (onDeSelectAll)="onUnSelectAll()" -->
                <!-- (onSelectAll)="onSelectAll($event)" -->
                <!-- (onDropDownClose)="onDropDownClose(question)" -->
                <!-- (mouseleave)="collapseMultiSelectDropdown(question?.order)" -->
                <!-- <div class="multiselect" (mouseleave)="collapseMultiSelectDropdown(question?.order)"
           [ngClass]="{'disable-question-field': ( question?.isQuestionDisabled ) }">
             <div class="selectBox" (click)="showCheckboxes(question?.order)">
               <span class="has-float-label">
                 <select class="form-control  font-weight-500" id="{{question.order}}"
                   placeholder="{{question.title}}" [ngClass]="{'invalid-border': question.errorMessage}"
                   [ngStyle]="{'color':question?.selectedValue?.length == 0 ? '#999999' : '#000000' }" style="font-size: 13px;">
                   <option *ngIf="question?.selectedValue?.length == 0; else showSelectedOption">Select {{question?.title}}
                   </option>
                   <ng-template #showSelectedOption>
                     <option>{{question?.selectedOptions}}</option>
                   </ng-template>
                 </select>
                 <label class="" for="{{question.order}}">{{question?.title}} <span *ngIf="question.required"
                     class="text-primary">*</span></label>

               </span>
               <div class="overSelect"></div>
             <mat-icon class="input-eye-icon" *ngIf="question?.hint" [matTooltip]="question?.hint">info</mat-icon>
             </div>
             <div class="checkboxes shadow custom-y-scroll" [id]="'checkboxes'+question.order">
               <ng-container *ngIf="question['checkboxes'+question.order]">
                 <div class="" style="padding: 10px;">
                   <span class="has-float-label">
                     <input type="text" class="font-weight-500 form-control" placeholder="Search..." appRestrictFirstCharAsSpace
                     [(ngModel)]="searchedText" (ngModelChange)="getFilterAnswerOption($event, question);" >
                     <label for="name">Search...</label>
                   </span>
                 </div>
                 <ng-container *ngFor="let option of question?.answer_option; let i=index"><br>
                   <mat-checkbox class="m-3  font-weight-500 font-13" id="{{option?._id}}"
                     (change)="onChange(question, $event, option)" [checked]="option?.checked">
                     {{option?.name}}
                   </mat-checkbox>
                 </ng-container>
               </ng-container>
             </div>
           </div> -->

                <mat-form-field class="w-100" [ngClass]="{'disable-question-field': ( question?.isQuestionDisabled ) }"
                    floatLabel="never">
                    <mat-label>{{question.hint}}
                    </mat-label>
                    <mat-select id="{{question.order}}" panelClass="custom-mat-select-panel" multiple
                        [(ngModel)]="question.value" [disableOptionCentering]="true"
                        (closed)="onSelectionClose(question?.order)" [disabled]="question?.isQuestionDisabled">
                        <div class="w-100 shadow-sm search-filter">
                            <!-- has-float-label - use this class in span tag and comment the label for floating label field -->
                            <span class="">
                                <input id="{{question.order+'_dropDownSearch'}}" type="text" class="form-control"
                                    placeholder="Search {{question.title}}" appRestrictFirstCharAsSpace appAlphabetOnly
                                    [(ngModel)]="searchedText"
                                    (ngModelChange)="getFilterAnswerOption($event, question);"
                                    (keydown)="$event.stopPropagation()">
                                <!-- <label for="{{question.order+'_dropDownSearch'}}">Search {{question.title}}</label> -->
                            </span>
                        </div>
                        <div class="single-select custom-y-scroll">
                            <mat-option *ngIf="question?.answer_option?.length == 0" disabled>No options available
                            </mat-option>
                            <mat-option *ngFor="let option of question?.answer_option; let i=index" [value]="option._id"
                                [disabled]="option?.disabled" [matTooltip]="option?.name" class="mb-2"
                                (click)="option?.disabled ? '' : onChange(question, {checked: !option.checked}, option)">
                                <!-- {{option?.name}} -->
                                <div class="d-flex flex-column mt-2" style="line-height: 1.2em;">
                                    <span>{{ option?.name }}</span>
                                    <span *ngIf="option && option.info" matTooltip="{{option?.info}}"
                                        class="option-info mt-1 text-truncate">{{option?.info}}</span>
                                </div>
                            </mat-option>
                        </div>
                    </mat-select>
                    <mat-icon class="input-eye-icon" *ngIf="question?.information" [matTooltip]="question?.information"
                        style="font-size: 16px; right: 20px;">info</mat-icon>
                </mat-form-field>

                <div class="col-sm-12  font-weight-500 text-primary error-msg" *ngIf="question.errorMessage">
                    {{question.information?question.information:question.errorMessage}}
                </div>
            </div>

            <!-- [ngClass]="{'col-sm-12': ( question.width == '100' || isOpenChevron ), 'col-sm-6': (question.width == '50' && !isOpenChevron ) || ( question.width == '25' && isOpenChevron ) , 'col-sm-3': ( question.width == '25' && !isOpenChevron ), 'custom-col-sm-2': ( question.width == '20' && !isOpenChevron ) }" -->
            <div class="common-font-family mb-3 col-12" *ngSwitchCase="QUESTION_TYPE.DATE">
                <!-- <div class="col-sm-12  font-weight-500" style="font-size: 80%; color: #6c757d;" >{{question.title}} <span *ngIf="question.required"
               class="text-primary">*</span></div> -->
                <!-- <mat-form-field class="col-sm-2" style="width: 18%">
           <input readonly matInput class="form-control  font-weight-500" placeholder="{{question.title}}" [(ngModel)]="question.modelValue" (change)="onChange(question, $event)" [ngModelOptions]="{standalone: true}"
                 [matDatepicker]="myDatepickerfrom">
           <mat-datepicker-toggle matSuffix [for]="myDatepickerfrom"></mat-datepicker-toggle>
           <mat-datepicker #myDatepickerfrom></mat-datepicker>
       </mat-form-field> -->
                <div class="common-font-family w-100  d-flex align-items-baseline" style="position: relative;">
                    <label class="label-wrapper  my-2 py-1 ps-3 rounded w-75" for="{{question.order}}"
                        *ngIf="!tablular">{{question.title}}
                        <span *ngIf="question.required" class="text-primary">*</span>
                    </label>

                    <input type="date" autocomplete="{{question.order}}" id="{{question.order}}" class="form-control "
                        placeholder="{{question.title}}" name="{{question.order}}" [(ngModel)]="question.modelValue"
                        [ngClass]="{
                            'disable-question-field disable-question-field-opacity': ( question?.isQuestionDisabled ),
                            'w-25': !tablular,
                            'w-100': tablular,
                            'ms-2': !tablular,
                            'invalid-border': question.errorMessage,
                            'warning-border': question.shortKey | durCustomWarnings : question: questionData : loopIndex
                        }" (change)="onChange(question, $event, {}, false, loopIndex)" [ngModelOptions]="{standalone: true}"
                        [readonly]="question?.isQuestionDisabled" [min]="question?.min || question?.minRange"
                        [max]="question?.max || question?.maxRange" (keydown)="restrictManuallyEnterDate()">
                    <mat-icon class="input-warning-icon" style="right: 25px;"
                        *ngIf="question.shortKey | durCustomWarnings : question: questionData : loopIndex"
                        [matTooltip]="question.shortKey | durCustomWarnings : question: questionData: loopIndex">warning
                    </mat-icon>
                    <mat-icon class="input-eye-icon" *ngIf="question?.information" [matTooltip]="question?.information"
                        style="right: 50px;">info</mat-icon>
                </div>
                <div class="col-sm-12 font-weight-500 text-primary error-msg" *ngIf="question.errorMessage">
                    {{question.information?question.information:question.errorMessage}}
                </div>
            </div>

            <!-- [ngClass]="{'col-sm-12': ( question.width == '100' || isOpenChevron ), 'col-sm-6': (question.width == '50' && !isOpenChevron ) || ( question.width == '25' && isOpenChevron ) , 'col-sm-3': ( question.width == '25' && !isOpenChevron ), 'invalid-border-class': ( question.errorMessage ), 'custom-col-sm-2': ( question.width == '20' && !isOpenChevron ) }" -->
            <div class="common-font-family customDropDown col-sm-12 d-none" *ngSwitchCase="QUESTION_TYPE.NESTED_ONE">
                <div class="d-flex justify-content-between w-100">
                    <mat-form-field class="w-100"
                        [ngClass]="{'disable-question-field': ( question?.isQuestionDisabled ) }">
                        <mat-label>{{question.title}}
                            <span *ngIf="question.required" class="text-primary">*</span>
                        </mat-label>

                        <mat-select id="{{question.order}}" [(value)]="question.modelValue"
                            [disableOptionCentering]="true" panelClass="custom-mat-select-panel"
                            (closed)="onSelectionClose(question?.order)" [disabled]="question?.isQuestionDisabled"
                            (selectionChange)="getSelectionChange(question, $event)">
                            <div class="w-100 shadow-sm search-filter">
                                <span class="">
                                    <input id="{{question.order+'_dropDownSearch'}}" type="text" class="form-control"
                                        placeholder="Search {{question.title}}" appRestrictFirstCharAsSpace
                                        appAlphabetOnly [(ngModel)]="searchedText"
                                        (ngModelChange)="getFilterAnswerOption($event, question);"
                                        (keydown)="$event.stopPropagation()">
                                </span>
                            </div>
                            <div class="single-select custom-y-scroll">
                                <mat-option *ngIf="question?.answer_option?.length == 0" disabled>No options available
                                </mat-option>
                                <mat-option *ngFor="let opt of question?.answer_option; trackBy:optionIdentity;"
                                    [value]="opt?._id" [disabled]="opt?.disabled" class="mb-2"
                                    [matTooltip]="opt.category ? opt.category : opt.name"
                                    (click)="opt?.disabled ? '' : onChange(question, {target: {value: opt._id, isSelected: true}})">
                                    <div class="d-flex flex-column mt-2" style="line-height: 1.2em;">
                                        <span>{{ opt.category ? opt.category : opt.name }}</span>
                                        <span *ngIf="opt && opt.info" matTooltip="{{opt?.info}}"
                                            class="option-info mt-1 text-truncate">{{opt?.info}}</span>
                                    </div>
                                </mat-option>
                            </div>
                        </mat-select>
                        <mat-icon class="input-eye-icon" *ngIf="question?.information"
                            [matTooltip]="question?.information" style="font-size: 16px; right: 15px;">info</mat-icon>
                    </mat-form-field>
                    <!-- <div *ngIf="question?.showComment" class="mb-1">
                         <span class="commentSelector" *ngIf="!pdfbuttonhide">
                             <app-show-comments (lastComment)="lastComment($event)" [location]="question?.commentApi" [lineItemId]="question?.commentLineItemId" [comment]="comments"></app-show-comments>
                         </span>
                     </div> -->
                </div>

                <!-- <span class="has-float-label" [ngClass]="{'disable-question-field': ( question?.isQuestionDisabled ) }">
             <select id="{{question.order}}" placeholder="{{question.title}}" (change)="onChange(question, $event)"
               name="question.modelValue" class="form-control "
               [ngClass]="{'invalid-border': question.errorMessage}" [(ngModel)]="question.modelValue">
               <option class="" value="" disabled>Select Option
               </option>
               <option class="" [value]="opt._id" *ngFor="let opt of question.answer_option;let i=index"
                 [hidden]="opt?.disabled">{{opt.name}}
               </option>
             </select>
             <label class="" for="{{question.order}}">{{question.title}} <span *ngIf="question.required"
                 class="text-primary">*</span></label>
                 <mat-icon class="input-eye-icon" *ngIf="question?.hint" [matTooltip]="question?.hint">info</mat-icon>
                 </span> -->
                <div class="col-sm-12  font-weight-500 text-primary error-msg" *ngIf="question.errorMessage">
                    {{question.information?question.information:question.errorMessage}}
                </div>
            </div>

            <div class="common-font-family mb-3"
                [ngClass]="{'col-sm-12': ( question.width == '100' || isOpenChevron ), 'col-sm-6': (question.width == '50' && !isOpenChevron ) || ( question.width == '25' && isOpenChevron ) , 'col-sm-3': ( question.width == '25' && !isOpenChevron ), 'custom-col-sm-2': ( question.width == '20' && !isOpenChevron ) }"
                *ngSwitchCase="QUESTION_TYPE.MULTI_SELECT_CHECKBOX">
                <div class="col-sm-12 mb-3 " id="{{question.order}}"
                    [ngClass]="{'invalid-border': question.errorMessage}">
                    {{question.title}}
                    <span *ngIf="question.required" class="text-primary">*</span>
                    <mat-icon class="radio-info-icon" *ngIf="question?.information"
                        [matTooltip]="question?.information">info</mat-icon>
                </div>
                <div class="col-sm-12" *ngFor="let option of question.answer_option;let i=index"
                    [ngClass]="{'disable-question-field': ( question?.isQuestionDisabled ) }">
                    <mat-checkbox class="m-3 " (change)="onChange(question, $event, option)" [checked]="option.checked">
                        {{option.name}}</mat-checkbox>
                </div>
                <div class="col-sm-12 font-weight-500 text-primary error-msg" *ngIf="question.errorMessage">
                    {{question.hint?question.hint:question.errorMessage}}
                </div>
            </div>

            <div class="common-font-family col-sm-6 customDropDown" *ngSwitchCase="QUESTION_TYPE.NESTED_TWO">
                <!-- <div class="col-sm-12 mb-3 " id="{{question.order}}" [ngClass]="{'invalid-border': question.errorMessage}">
                     {{question.title}}
                     <span *ngIf="question.required" class="text-primary">*</span>
                     <mat-icon class="radio-info-icon" *ngIf="question?.information" [matTooltip]="question?.information">info</mat-icon>
                 </div>
                 <div class="col-sm-12" *ngFor="let option of question.answer_option;let i=index" [ngClass]="{'disable-question-field': ( question?.isQuestionDisabled ) }">
                     <mat-checkbox class="m-3 " (change)="onChange(question, $event, option)" [checked]="option.checked">{{option.name}}</mat-checkbox>

                 </div>
                 <div class="col-sm-12 font-weight-500 text-primary error-msg" *ngIf="question.errorMessage">
                     {{question.information?question.information:question.errorMessage}}
                 </div> -->
                <label for="{{question.order}}">{{question.title}}<span *ngIf="question.required"
                        class="text-primary">*</span></label>

                <div class="d-flex justify-content-between w-100">
                    <mat-form-field class="w-100"
                        [ngClass]="{'disable-question-field': ( question?.isQuestionDisabled ) }" floatLabel="never">
                        <mat-label>{{question.hint ? question.hint : "Select Answer" }}
                        </mat-label>
                        <mat-select id="{{question.order}}" panelClass="custom-mat-select-panel" multiple
                            [(ngModel)]="question.value" [disableOptionCentering]="true"
                            (closed)="onSelectionClose(question?.order)" [disabled]="question?.isQuestionDisabled">
                            <div class="w-100 shadow-sm search-filter">
                                <!-- has-float-label - use this class in span tag and comment the label for floating label field -->
                                <span class="">
                                    <input id="{{question.order+'_dropDownSearch'}}" type="text" class="form-control"
                                        placeholder="Search {{question.title}}" appRestrictFirstCharAsSpace
                                        appAlphabetOnly [(ngModel)]="searchedText"
                                        (ngModelChange)="getFilterAnswerOption($event, question);"
                                        (keydown)="$event.stopPropagation()">
                                    <!-- <label for="{{question.order+'_dropDownSearch'}}">Search {{question.title}}</label> -->
                                </span>
                            </div>
                            <div class="single-select custom-y-scroll">
                                <mat-option *ngIf="question?.answer_option?.length == 0" disabled>No options available
                                </mat-option>
                                <mat-option *ngFor="let option of question?.answer_option; let i=index"
                                    [value]="option._id" [disabled]="option?.disabled" [matTooltip]="option?.name"
                                    class="mb-2"
                                    (click)="option?.disabled ? '' : onChange(question, {checked: !option.checked}, option)">
                                    <!-- {{option?.name}} -->
                                    <div class="d-flex flex-column mt-2" style="line-height: 1.2em;">
                                        <span>{{ option?.name }}</span>
                                        <span *ngIf="option && option.info" matTooltip="{{option?.info}}"
                                            class="option-info mt-1 text-truncate">{{option?.info}}</span>
                                    </div>
                                </mat-option>
                            </div>
                        </mat-select>
                        <mat-icon class="input-eye-icon" *ngIf="question?.information"
                            [matTooltip]="question?.information" style="font-size: 16px; right: 20px;">info</mat-icon>
                    </mat-form-field>
                    <!-- <div *ngIf="question?.showComment" class="mb-1">
                         <span class="commentSelector" *ngIf="!pdfbuttonhide">
                             <app-show-comments (lastComment)="lastComment($event)" [location]="question?.commentApi" [lineItemId]="question?.commentLineItemId" [comment]="comments"></app-show-comments>
                         </span>
                     </div> -->
                </div>


                <div class="col-sm-12  font-weight-500 text-primary error-msg" *ngIf="question.errorMessage">
                    {{question.information?question.information:question.errorMessage}}
                </div>
            </div>


            <div class="common-font-family mb-3 col-sm-12" *ngSwitchCase="QUESTION_TYPE.LABEL">
                <!-- <div class="col-sm-12 mb-3 " [innerHTML]="question.title | safe: 'html'" id="{{question.order}}" [ngClass]="{'invalid-border': question.errorMessage}"> -->
                <div class="d-flex"
                    style="border-radius: 4px 4px 0 0;background: #058E91; color: white; padding:12px; font-weight:600;"
                    id="{{question.order}}" [ngClass]="{'invalid-border': question.errorMessage}"> {{question?.title}}
                    <!-- <div *ngIf="question?.showComment" class="technicalComments">
                         <span class="commentSelector" *ngIf="!pdfbuttonhide">
                             <app-show-comments (lastComment)="lastComment($event)" [location]="question?.commentApi" [lineItemId]="question?.commentLineItemId" [comment]="comments"></app-show-comments>
                         </span>
                     </div> -->
                      <mat-icon class="mat-info-icon" *ngIf="question?.information"
                            [matTooltip]="question?.information" style="font-size: 16px; right: 15px;">info</mat-icon>
                </div>
            </div>


            <div class="common-font-family col-sm-12 border rounded-bottom" style="background-color: #F7F7F7;"
                *ngSwitchDefault>
                <div class="mb-3 " *ngIf="question?.title">{{question.title}} <span *ngIf="question.required"
                        class="text-primary">*</span>
                </div>

                <ng-container *ngIf="!question?.title">

                    <!-- <p>{{ question | json }}</p> -->



                    <div class="row mx-1">
                        <ng-container *ngFor="let child of question;  let questionIndexes = index"
                            [ngTemplateOutlet]="treeNode"
                            [ngTemplateOutletContext]="{ question: child, questionIndex:questionIndexes, value: []}">
                        </ng-container>
                    </div>


                </ng-container>
            </div>



        </ng-container>
        <!-- <div class="col-sm-12 font-weight-500 text-primary error-msg" *ngIf="question.errorMessage">
         {{question.hint?question.hint:question.errorMessage}}
       </div> -->

        <button class="btn btn-primary w-auto ms-2" *ngIf="!isProjectLoaded && question.shortKey | addButton"
            (click)="loadInParent('projects')">Load Projects</button>

        <ng-container *ngIf="question?.childQuestionData?.length > 0">
            <div *ngIf="question.shortKey | tableView" class="mt-3 custom-scroll {{question.shortKey}}">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h6>{{ question?.title }} <mat-icon *ngIf="question?.information" style="font-size: medium;"
                            [matTooltip]="question?.information">info</mat-icon>
                    </h6>
                    <mat-paginator #paginator *ngIf="question?.childQuestionData?.length > 10"
                        [length]="question?.childQuestionData?.length" 
                        [pageSize]="pageSize"
                        [pageSizeOptions]="pageSizeOptions"
                        [showFirstLastButtons]="true"
                        (page)="pageChange(question, $event)"></mat-paginator>
                </div>
                
                <table class="table table-striped dur-tbl" style="table-layout: fixed;">
                    <thead style="background-color: #058E91; color: white;">
                        <tr>
                            <th scope="col" style="width: 3%">#</th>
                            <th scope="col" *ngFor="let child of question.tableHeaders;"
                                [ngStyle]="{width: child.width || 'initial'}">{{
                                child.label }}
                                <mat-icon *ngIf="child?.information" style="font-size: medium;"
                                    [matTooltip]="child?.information">info</mat-icon>
                            </th>
                            <th *ngIf="question.shortKey | addButton" style="width: 4%;"></th>
                        </tr>
                    </thead>
                    <tbody style="border-top: none;">
                        <tr
                            *ngFor="let row of question.childQuestionData | scrollTable : question.scrollIndex : pageSize ; trackBy:rowIdentity; let rowIndex = index;">
                            <th scope="row">{{ rowIndex + (question.scrollIndex || 0) + 1 | tableSequence: question
                                }}</th>
                            
                            <ng-container *ngFor="let child of row; trackBy:identity; let questionIndexes = index">
                                <td *ngIf="!child?.hidden">
                                    <ng-container *ngIf="child.visibility" [ngTemplateOutlet]="treeNode"
                                        [ngTemplateOutletContext]="{
                                                question: child,
                                                questionIndex:questionIndexes,
                                                loopIndex: rowIndex,
                                                value: [question.value[questionIndexes]],
                                                parent: question,
                                                tablular: true}">
                                    </ng-container>
                                </td>
                            </ng-container>
                            <!-- <td *ngFor="let item of [].constructor(row.length - (row | myfilter).length)"></td> -->
                            <td *ngIf="question.shortKey | addButton">
                                <mat-icon
                                    *ngIf="(!question?.minChild || question?.minChild <= rowIndex) && questionresponse?.data[0]?.isQuestionDisabled == false && !(form == 'dur' && questionresponse.latest)"
                                    (click)="removeChildQuestion(question, rowIndex)"
                                    style="color: red; cursor: pointer;">delete</mat-icon>
                            </td>
                        </tr>
                        <tr *ngIf="question.lastRow">
                            <th></th>
                            <th *ngFor="let item of question.lastRow; let i = index;">{{ item | tableRowCalculator:
                                question?.childQuestionData : i }}</th>
                        </tr>
                    </tbody>

                </table>
                <small class="text-danger d-block"
                    *ngIf="finalSubmitted && (question.shortKey | durCustomErrors : parent : questionData)">{{
                    question.shortKey | durCustomErrors : parent : questionData }}</small>
                <small class="text-danger d-block"
                    *ngIf="finalSubmitted && (question.shortKey | gtcCustomErrors : parent : questionData)">{{
                    question.shortKey | gtcCustomErrors : parent : questionData }}</small>
                <div class="d-flex justify-content-end"
                    *ngIf="questionresponse?.data[0]?.isQuestionDisabled == false && !(form == 'dur' && questionresponse.latest) && question.shortKey | addButton">
                    <button class="btn btn-success m-2" (click)="addChildQuestion(question)">Add</button>
                </div>
            </div>
            <div class="common-font-family col-sm-12 my-4" *ngIf="!(question.shortKey | tableView)">
                <ng-container
                    *ngFor="let row of question.childQuestionData; trackBy:rowIdentity;  let questionIndexes = index">
                    <div style="border-radius: 4px 4px 0 0;
                    background-color: #058E91;
                    color: white;
                    padding: 12px;
                    font-weight: 600;" class="w-100 mr-4 d-flex justify-content-between ml-4">
                        <span>{{question.input_type == QUESTION_TYPE.NESTED_ONE ? question.title
                            :child[0]?.selectedAnswerOption?.name}}</span>
                        <!-- <div *ngIf="question?.showComment" class="mr-3">
                            <span class="commentSelector" *ngIf="!pdfbuttonhide">
                                <app-show-comments (lastComment)="lastComment($event)" [location]="question?.commentApi" [lineItemId]="question?.commentLineItemId" [comment]="comments"></app-show-comments>
                            </span>
                        </div> -->
                    </div>
                    <ng-container *ngFor="let child of row | myfilter; trackBy:identity;">

                        <ng-container [ngTemplateOutlet]="treeNode" [ngTemplateOutletContext]="{
                                question: child,
                                questionIndex:questionIndexes,
                                parent: question,
                                value: [question.value[questionIndexes]]}">
                            <!-- {{question.childQuestionData | json}} -->

                        </ng-container>
                    </ng-container>

                </ng-container>
            </div>
        </ng-container>


    </ng-template>

    <!-- <div class="custom-loader" *ngIf="isImageUploading">
        <mat-spinner mode="indeterminate"></mat-spinner>
    </div> -->
</ng-container>

<ng-container *ngIf="!isViewMode && viewFormTemplate == 'commonFormCf'">
    <div class="container-fluid">
        <div class="row mt-3 mb-4">
            <!----------- form name --------->
            <div class="col-sm-12" *ngIf="questionresponse?.data?.length > 0">
                <div class="form-h">
                    {{questionresponse?.data[0]?.language[0]?.title}}
                    <div class="pre-div float-end d-inline-block">
                        <button class="btn btn-upload" (click)="onPreview()">Preview</button>
                    </div>
                </div>
            </div>
            <!----------- form description --------->
            <div class="col-sm-12 mt-2" [innerHtml]="questionresponse?.data[0]?.language[0]?.prevStatus">
            </div>
            <!------- form ----------->
            <div class="col-sm-12 mt-4">
                <div class="card">
                    <div class="card-body">
                        <ng-container
                            *ngFor="let question of questionData | myfilter; trackBy:identity; let questionIndex = index"
                            [ngTemplateOutlet]="treeNode"
                            [ngTemplateOutletContext]="{ question: question, questionIndex:questionIndex, value: [] }">
                        </ng-container>
                    </div>
                </div>
            </div>

        </div>

        <div class="row mt-3 mb-3" *ngIf="isButtonDisplay">
            <!-- save, draft, pre and next button -->
            <div class="col-sm-6">
                <button class="btn btn-pre" (click)="nextPrevBtnCall('pre')">
                    <- Previous Form </button>
            </div>
            <div class="col-sm-6 d-flex justify-content-end">
                <div class="d-inline-flex mr1" *ngIf="showDraftButton">
                    <button class="btn btn-save text-uppercase" [disabled]="isImageUploading || (isFormDisable)"
                        (click)="beforeSubmitPrepareResponse(true)" *ngIf="!pdfbuttonhide">
                        Save as Draft
                    </button>
                </div>
                <div class="d-inline-flex mr1" *ngIf="showSubmitButton">
                    <button class="btn btn-save text-uppercase" [disabled]="isImageUploading || (isFormDisable)"
                        (click)="beforeSubmitPrepareResponse()" *ngIf="!pdfbuttonhide">
                        {{buttonText}}
                    </button>
                </div>
                <div class="d-inline-flex " *ngIf="!hideNextButton">
                    <button class="btn btn-next text-uppercase" (click)="nextPrevBtnCall('next')">
                        Next Form ->
                    </button>
                </div>
            </div>
        </div>
    </div>

    <ng-template #treeNode let-question="question" let-questionIndex="questionIndex" let-value="value">
        <ng-container [ngSwitch]="question?.input_type">
            <div class="row mb-3" *ngSwitchCase="QUESTION_TYPE.TEXT">
                <div class="col-sm-6">
                    <label for="{{question.order}}">{{question.title}}<span *ngIf="question?.required"
                            class="text-primary">*</span></label>
                </div>
                <div class="col-sm-6">
                    <span class=""
                        [ngClass]="{'disable-question-field disable-question-field-opacity': ( question?.isQuestionDisabled ) }">
                        <input type="{{question?.passwordMode ? 'password' : 'text'}}" autocomplete="{{question.order}}"
                            name="{{question.order}}" appAlphabetOnly class="form-control "
                            pattern="{{question?.pattern}}" placeholder="{{question?.hint}}"
                            minlength="{{question.min}}" appRestrictFirstCharAsSpace
                            [ngClass]="{'invalid-border': question.errorMessage}" maxlength="{{question.max}}"
                            id="{{(question?.forParentValue) ? question?.forParentValue : question.order}}"
                            [value]="question.modelValue ? question.modelValue : ''"
                            (change)="onChange(question, $event)" [ngModelOptions]="{standalone: true}"
                            (focus)="onFocusEvent(question.order, question)"
                            [readonly]="question?.isQuestionDisabled"  [appNumberLength]="question.max"/>
                        <ng-container *ngIf="question?.isPassword">
                            <i *ngIf="!question?.passwordMode" [matTooltip]="'Hide'"
                                (click)="question.passwordMode = !question.passwordMode"
                                class="fa fa-eye passwordShowHide pointer-hand" aria-hidden="true"></i>
                            <i *ngIf="question?.passwordMode" [matTooltip]="'Show'"
                                (click)="question.passwordMode = !question.passwordMode"
                                class="fa fa-eye-slash passwordShowHide pointer-hand" aria-hidden="true"></i>
                        </ng-container>
                        <mat-icon class="mat-info-icon" *ngIf="question?.information"
                            [matTooltip]="question?.information">info</mat-icon>
                    </span>
                    <div *ngIf="(question?.labelInstruction) && (!question.errorMessage)" class="label-instruction">
                        <em>* {{question?.labelInstruction}}</em>
                    </div>
                    <div class="col-sm-12  font-weight-500 text-primary error-msg" *ngIf="question.errorMessage">
                        {{question.information ? question.information : question.errorMessage}}
                    </div>
                </div>
            </div>
            <div class="row customDropDown mb-3" *ngSwitchCase="QUESTION_TYPE.SINGLE_SELECT">
                <div class="col-sm-6">
                    <label for="{{question.order}}">{{question.title}}<span *ngIf="question.required"
                            class="text-primary">*</span></label>
                </div>
                <div class="col-sm-6">
                    <mat-form-field class="w-100"
                        [ngClass]="{'disable-question-field': ( question?.isQuestionDisabled ) }" floatLabel="never">
                        <mat-label>{{question.hint}}
                        </mat-label>

                        <mat-select id="{{question.order}}" [(value)]="question.modelValue"
                            [disableOptionCentering]="true" panelClass="custom-mat-select-panel"
                            (closed)="onSelectionClose(question?.order)" [disabled]="question?.isQuestionDisabled"
                            (selectionChange)="getSelectionChange(question, $event)">
                            <div class="w-100 shadow-sm search-filter">
                                <span class="">
                                    <input id="{{question.order+'_dropDownSearch'}}" type="text" class="form-control"
                                        placeholder="Search {{question.title}}" appRestrictFirstCharAsSpace
                                        appAlphabetOnly [(ngModel)]="searchedText"
                                        (ngModelChange)="getFilterAnswerOption($event, question);"
                                        (keydown)="$event.stopPropagation()">
                                </span>
                            </div>
                            <div class="single-select custom-y-scroll">
                                <mat-option *ngIf="question?.answer_option?.length == 0" disabled>No options available
                                </mat-option>
                                <mat-option *ngFor="let opt of question?.answer_option; trackBy:optionIdentity;"
                                    [value]="opt?._id" [disabled]="opt?.disabled" class="mb-2"
                                    [matTooltip]="opt.category ? opt.category : opt.name"
                                    (click)="opt?.disabled ? '' : onChange(question, {target: {value: opt._id, isSelected: true}})">
                                    <div class="d-flex flex-column mt-2" style="line-height: 1.2em;">
                                        <span>{{ opt.category ? opt.category : opt.name }}</span>
                                        <span *ngIf="opt && opt.info" matTooltip="{{opt?.info}}"
                                            class="option-info mt-1 text-truncate">{{opt?.info}}</span>
                                    </div>
                                </mat-option>
                            </div>
                        </mat-select>
                        <mat-icon class="mat-info-icon" *ngIf="question?.information"
                            [matTooltip]="question?.information" style="font-size: 16px; right: 15px;">info</mat-icon>
                    </mat-form-field>

                    <div class="font-weight-500 text-primary error-msg" *ngIf="question.errorMessage" style="">
                        {{question.errorMessage ? question.errorMessage : question?.hint}}
                    </div>
                    <div class="scoreDiv mt-2"
                        *ngIf="(formName == 'odf' || formName == 'gfc') && (question?.shortKey == 'rating')">
                        <div>Score = {{(odfGfcMarks || odfGfcMarks === 0) ? odfGfcMarks : 'N/A'}}</div>
                    </div>
                </div>
            </div>
            <div class="row mb-3" *ngSwitchCase="QUESTION_TYPE.FILE_UPLOAD">
                <div class="col-sm-6">
                    <div>
                        {{question.title}}
                        <span *ngIf="question.required" class="text-primary">*</span>
                        <mat-icon class="file-type-info" *ngIf="question?.information"
                            [matTooltip]="question?.information">info</mat-icon>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="custom-file">
                        <input type="file" id="{{question.order}}" class="form-control d-none"
                            [accept]="question?.acceptableType" (change)="docsInputChangeHandler($event, question)"
                            style="background-color: white !important; border-bottom: 0 !important"
                            onclick="value = null;">
                        <!-- <button class="btn btn-upload"
                            [disabled]="question?.isQuestionDisabled">{{question.hint}}</button> -->
                        <button class="btn btn-upload" (click)="imageInputClickHandler($event, question)"
                            [disabled]="question?.isQuestionDisabled">{{question.hint}}</button>
                        <label class="custom-file-label pointer-hand d-none" for="customFile"
                            [ngClass]="{'invalid-border': question.errorMessage}">
                            {{question.imgLabel ? question.imgLabel : question?.selectedValue?.length ?
                            question?.selectedValue[0]?.label : 'Choose file'}}</label>
                        <div class="font-weight-500 text-primary error-msg" *ngIf="question.errorMessage">
                            {{question.errorMessage ? question.errorMessage : question?.hint}}
                        </div>

                    </div>

                </div>
                <div class="col-sm-12 mt-3">
                    <span *ngFor="let file of question?.selectedValue" class="mb-3 ms-2">
                        <ng-container *ngIf="file?.value">
                            <a matTooltip="Click to view the file" class="f-name" target="_blank"
                                href="{{file?.value | toStorageUrl}}">{{file?.label}}</a>
                            <span class="material-icons file-icon-cross pointer-hand"
                                [ngClass]="{'disable-question-field': ( question?.isQuestionDisabled ) }"
                                matTooltip="Remove the upload file"
                                (click)="removeUploadedFile(question, question?.order)">cancel</span>

                        </ng-container>
                    </span>

                </div>
            </div>
            <div class="row mb-3" *ngSwitchCase="QUESTION_TYPE.DATE">
                <div class="col-sm-6">
                    <label class="" for="{{question.order}}">{{question.title}}
                        <span *ngIf="question.required" class="text-primary">*</span>
                    </label>
                </div>
                <div class="col-sm-6">
                    <div class=""
                        [ngClass]="{'disable-question-field disable-question-field-opacity': ( question?.isQuestionDisabled ) }">
                        <input type="date" autocomplete="{{question.order}}" id="{{question.order}}"
                            class="form-control " placeholder="dd/mm/yyyy"
                            [ngClass]="{'invalid-border': question.errorMessage}" name="{{question.order}}"
                            [(ngModel)]="question.modelValue" (change)="onChange(question, $event)"
                            [ngModelOptions]="{standalone: true}" [readonly]="question?.isQuestionDisabled"
                            [min]="question?.min" [max]="question?.max" (keydown)="restrictManuallyEnterDate()">

                        <mat-icon class="mat-info-icon" *ngIf="question?.information"
                            [matTooltip]="question?.information" style="right: 50px;">info</mat-icon>
                    </div>
                    <div class="font-weight-500 text-primary error-msg" *ngIf="question.errorMessage">
                        {{question.information? question.information: question.errorMessage}}
                    </div>
                </div>


            </div>
            <div class="row mb-3" *ngSwitchCase="QUESTION_TYPE.NUMERIC">
                <div class="col-sm-6">
                    <div class="">
                        <label class="" for="{{question.order}}">{{question.title}} <span *ngIf="question.required"
                                class="text-primary">*</span></label>
                        <mat-icon class="mat-info-icon" *ngIf="question?.information"
                            [matTooltip]="question?.information">info</mat-icon>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="" [ngClass]="{'disable-question-field': ( question?.isQuestionDisabled ) }">
                        <input digitOnly [decimal]="question?.skipDigitOnlyValidation" type="number"
                            class="form-control " [appNumberLength]="question.max" placeholder="{{question.hint}}"
                            [ngClass]="{'invalid-border': question.errorMessage}" minlength="{{question.min}}"
                            maxlength="{{question.max}}" id="{{question.order}}"
                            [value]="question.modelValue ? question.modelValue : ''"
                            (keyup)="onChange(question, $event)" [ngModelOptions]="{standalone: true}"
                            (focus)="onFocusEvent(question.order, question)"
                            [appRestrictFirstDigitAsZero]="isAppRestrictFirstDigitAsZero"
                            [readonly]="question?.isQuestionDisabled" title=""/>

                    </div>
                    <div *ngIf="(question?.labelInstruction) && (!question.errorMessage)" class="label-instruction">
                        <em>* {{question?.labelInstruction}}</em>
                    </div>
                    <div class="col-sm-12  font-weight-500 text-primary error-msg" *ngIf="question.errorMessage">
                        {{question.information?question.information:question.errorMessage}}
                    </div>
                    <!-- <div class="mt-2">
                          {{question.modelValue | toWord}}
                      </div> -->
                </div>

            </div>

            <div class="row mb-3" *ngSwitchCase="QUESTION_TYPE.RADIO">

                <div class="col-6 mb-3  "
                    [ngClass]="{'invalid-border': question.errorMessage,'disable-question-field': question?.isQuestionDisabled }"
                    style="">
                    {{question.title}}
                    <span *ngIf="question.required" class="text-primary">*</span>
                    <mat-icon class="radio-info-icon" *ngIf="question?.information"
                        [matTooltip]="question?.information">info</mat-icon>
                </div>
                <div class="col-6 d-flex justify-content-between">
                    <mat-radio-group aria-label="Select an option"
                        [ngClass]="{'disable-question-field': ( question?.isQuestionDisabled ) }"
                        [disabled]="question?.isQuestionDisabled">
                        <mat-radio-button class="mr-2 " [disabled]="option?.disabled"
                            *ngFor="let option of question.answer_option;let i=index" [value]="option._id"
                            [checked]="option._id == question.modelValue" (change)="onChange(question, $event, option)">
                            {{option?.name}}
                        </mat-radio-button>


                    </mat-radio-group>
                </div>
                <div class="col-6  font-weight-500 text-primary error-msg" *ngIf="question.errorMessage">
                    {{question.errorMessage ? question.errorMessage: question.information}}
                </div>

            </div>

        </ng-container>
    </ng-template>

</ng-container>


<ng-container *ngIf="isViewMode">

    <!-- <h4 class="text-center text-primary common-font-family" *ngIf="title">{{title}}</h4>
   <div class="flex-container mt-3">
     <div class="mt-2" *ngFor="let item of questionResponse; let i = index ">
       <label for="staticEmail" class="col-form-label form-label">{{item?.title}}</label>
       <div class="padding">
         <span class="custom-text-truncate" >{{getSelectedValue(item)}}</span>
       </div>
     </div>
   </div> -->
    <!-- <app-web-form-view class="mb-2" [questions]="questionresponse" [template]="viewFormTemplate" [title]="title"></app-web-form-view> -->

</ng-container>